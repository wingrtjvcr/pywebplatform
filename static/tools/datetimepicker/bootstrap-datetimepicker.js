/* =========================================================
 * bootstrap-datetimepicker.js
 * =========================================================
 * Copyright 2012 Stefan Petre
 *
 * Improvements by Andrew Rowls
 * Improvements by Sébastien Malot
 * Improvements by Yun Lai
 * Improvements by Kenneth Henderick
 * Improvements by CuGBabyBeaR
 * Improvements by Christian Vaas <auspex@auspex.eu>
 *
 * Project URL : http://www.malot.fr/bootstrap-datetimepicker
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */

(function(factory){
    if (typeof define === 'function' && define.amd)
      define(['jquery'], factory);
    else if (typeof exports === 'object')
      factory(require('jquery'));
    else
      factory(jQuery);

}(function($, undefined){

  // Add ECMA262-5 Array methods if not supported natively (IE8)
  if (!('indexOf' in Array.prototype)) {
    Array.prototype.indexOf = function (find, i) {
      if (i === undefined) i = 0;
      if (i < 0) i += this.length;
      if (i < 0) i = 0;
      for (var n = this.length; i < n; i++) {
        if (i in this && this[i] === find) {
          return i;
        }
      }
      return -1;
    }
  }

  // Add timezone abbreviation support for ie6+, Chrome, Firefox
  function timeZoneAbbreviation() {
    var abbreviation, date, formattedStr, i, len, matchedStrings, ref, str;
    date = (new Date()).toString();
    formattedStr = ((ref = date.split('(')[1]) != null ? ref.slice(0, -1) : 0) || date.split(' ');
    if (formattedStr instanceof Array) {
      matchedStrings = [];
      for (var i = 0, len = formattedStr.length; i < len; i++) {
        str = formattedStr[i];
        if ((abbreviation = (ref = str.match(/\b[A-Z]+\b/)) !== null) ? ref[0] : 0) {
          matchedStrings.push(abbreviation);
        }
      }
      formattedStr = matchedStrings.pop();
    }
    return formattedStr;
  }

  function UTCDate() {
    return new Date(Date.UTC.apply(Date, arguments));
  }

  // Picker object
  var Datetimepicker = function (element, options) {
	// TRE周别  
	this.treWeeks = {"2016/1/1":1,"2016/1/2":1,"2016/1/3":1,"2016/1/4":2,"2016/1/5":2,"2016/1/6":2,"2016/1/7":2,"2016/1/8":2,"2016/1/9":2,"2016/1/10":2,"2016/1/11":3,"2016/1/12":3,"2016/1/13":3,"2016/1/14":3,"2016/1/15":3,"2016/1/16":3,"2016/1/17":3,"2016/1/18":4,"2016/1/19":4,"2016/1/20":4,"2016/1/21":4,"2016/1/22":4,"2016/1/23":4,"2016/1/24":4,"2016/1/25":5,"2016/1/26":5,"2016/1/27":5,"2016/1/28":5,"2016/1/29":5,"2016/1/30":5,"2016/1/31":5,"2016/2/1":6,"2016/2/2":6,"2016/2/3":6,"2016/2/4":6,"2016/2/5":6,"2016/2/6":6,"2016/2/7":6,"2016/2/8":7,"2016/2/9":7,"2016/2/10":7,"2016/2/11":7,"2016/2/12":7,"2016/2/13":7,"2016/2/14":7,"2016/2/15":8,"2016/2/16":8,"2016/2/17":8,"2016/2/18":8,"2016/2/19":8,"2016/2/20":8,"2016/2/21":8,"2016/2/22":9,"2016/2/23":9,"2016/2/24":9,"2016/2/25":9,"2016/2/26":9,"2016/2/27":9,"2016/2/28":9,"2016/2/29":10,"2016/3/1":10,"2016/3/2":10,"2016/3/3":10,"2016/3/4":10,"2016/3/5":10,"2016/3/6":10,"2016/3/7":11,"2016/3/8":11,"2016/3/9":11,"2016/3/10":11,"2016/3/11":11,"2016/3/12":11,"2016/3/13":11,"2016/3/14":12,"2016/3/15":12,"2016/3/16":12,"2016/3/17":12,"2016/3/18":12,"2016/3/19":12,"2016/3/20":12,"2016/3/21":13,"2016/3/22":13,"2016/3/23":13,"2016/3/24":13,"2016/3/25":13,"2016/3/26":13,"2016/3/27":13,"2016/3/28":14,"2016/3/29":14,"2016/3/30":14,"2016/3/31":14,"2016/4/1":14,"2016/4/2":14,"2016/4/3":14,"2016/4/4":15,"2016/4/5":15,"2016/4/6":15,"2016/4/7":15,"2016/4/8":15,"2016/4/9":15,"2016/4/10":15,"2016/4/11":16,"2016/4/12":16,"2016/4/13":16,"2016/4/14":16,"2016/4/15":16,"2016/4/16":16,"2016/4/17":16,"2016/4/18":17,"2016/4/19":17,"2016/4/20":17,"2016/4/21":17,"2016/4/22":17,"2016/4/23":17,"2016/4/24":17,"2016/4/25":18,"2016/4/26":18,"2016/4/27":18,"2016/4/28":18,"2016/4/29":18,"2016/4/30":18,"2016/5/1":18,"2016/5/2":19,"2016/5/3":19,"2016/5/4":19,"2016/5/5":19,"2016/5/6":19,"2016/5/7":19,"2016/5/8":19,"2016/5/9":20,"2016/5/10":20,"2016/5/11":20,"2016/5/12":20,"2016/5/13":20,"2016/5/14":20,"2016/5/15":20,"2016/5/16":21,"2016/5/17":21,"2016/5/18":21,"2016/5/19":21,"2016/5/20":21,"2016/5/21":21,"2016/5/22":21,"2016/5/23":22,"2016/5/24":22,"2016/5/25":22,"2016/5/26":22,"2016/5/27":22,"2016/5/28":22,"2016/5/29":22,"2016/5/30":23,"2016/5/31":23,"2016/6/1":23,"2016/6/2":23,"2016/6/3":23,"2016/6/4":23,"2016/6/5":23,"2016/6/6":24,"2016/6/7":24,"2016/6/8":24,"2016/6/9":24,"2016/6/10":24,"2016/6/11":24,"2016/6/12":24,"2016/6/13":25,"2016/6/14":25,"2016/6/15":25,"2016/6/16":25,"2016/6/17":25,"2016/6/18":25,"2016/6/19":25,"2016/6/20":26,"2016/6/21":26,"2016/6/22":26,"2016/6/23":26,"2016/6/24":26,"2016/6/25":26,"2016/6/26":26,"2016/6/27":27,"2016/6/28":27,"2016/6/29":27,"2016/6/30":27,"2016/7/1":27,"2016/7/2":27,"2016/7/3":27,"2016/7/4":28,"2016/7/5":28,"2016/7/6":28,"2016/7/7":28,"2016/7/8":28,"2016/7/9":28,"2016/7/10":28,"2016/7/11":29,"2016/7/12":29,"2016/7/13":29,"2016/7/14":29,"2016/7/15":29,"2016/7/16":29,"2016/7/17":29,"2016/7/18":30,"2016/7/19":30,"2016/7/20":30,"2016/7/21":30,"2016/7/22":30,"2016/7/23":30,"2016/7/24":30,"2016/7/25":31,"2016/7/26":31,"2016/7/27":31,"2016/7/28":31,"2016/7/29":31,"2016/7/30":31,"2016/7/31":31,"2016/8/1":32,"2016/8/2":32,"2016/8/3":32,"2016/8/4":32,"2016/8/5":32,"2016/8/6":32,"2016/8/7":32,"2016/8/8":33,"2016/8/9":33,"2016/8/10":33,"2016/8/11":33,"2016/8/12":33,"2016/8/13":33,"2016/8/14":33,"2016/8/15":34,"2016/8/16":34,"2016/8/17":34,"2016/8/18":34,"2016/8/19":34,"2016/8/20":34,"2016/8/21":34,"2016/8/22":35,"2016/8/23":35,"2016/8/24":35,"2016/8/25":35,"2016/8/26":35,"2016/8/27":35,"2016/8/28":35,"2016/8/29":36,"2016/8/30":36,"2016/8/31":36,"2016/9/1":36,"2016/9/2":36,"2016/9/3":36,"2016/9/4":36,"2016/9/5":37,"2016/9/6":37,"2016/9/7":37,"2016/9/8":37,"2016/9/9":37,"2016/9/10":37,"2016/9/11":37,"2016/9/12":38,"2016/9/13":38,"2016/9/14":38,"2016/9/15":38,"2016/9/16":38,"2016/9/17":38,"2016/9/18":38,"2016/9/19":39,"2016/9/20":39,"2016/9/21":39,"2016/9/22":39,"2016/9/23":39,"2016/9/24":39,"2016/9/25":39,"2016/9/26":40,"2016/9/27":40,"2016/9/28":40,"2016/9/29":40,"2016/9/30":40,"2016/10/1":40,"2016/10/2":40,"2016/10/3":41,"2016/10/4":41,"2016/10/5":41,"2016/10/6":41,"2016/10/7":41,"2016/10/8":41,"2016/10/9":41,"2016/10/10":42,"2016/10/11":42,"2016/10/12":42,"2016/10/13":42,"2016/10/14":42,"2016/10/15":42,"2016/10/16":42,"2016/10/17":43,"2016/10/18":43,"2016/10/19":43,"2016/10/20":43,"2016/10/21":43,"2016/10/22":43,"2016/10/23":43,"2016/10/24":44,"2016/10/25":44,"2016/10/26":44,"2016/10/27":44,"2016/10/28":44,"2016/10/29":44,"2016/10/30":44,"2016/10/31":45,"2016/11/1":45,"2016/11/2":45,"2016/11/3":45,"2016/11/4":45,"2016/11/5":45,"2016/11/6":45,"2016/11/7":46,"2016/11/8":46,"2016/11/9":46,"2016/11/10":46,"2016/11/11":46,"2016/11/12":46,"2016/11/13":46,"2016/11/14":47,"2016/11/15":47,"2016/11/16":47,"2016/11/17":47,"2016/11/18":47,"2016/11/19":47,"2016/11/20":47,"2016/11/21":48,"2016/11/22":48,"2016/11/23":48,"2016/11/24":48,"2016/11/25":48,"2016/11/26":48,"2016/11/27":48,"2016/11/28":49,"2016/11/29":49,"2016/11/30":49,"2016/12/1":49,"2016/12/2":49,"2016/12/3":49,"2016/12/4":49,"2016/12/5":50,"2016/12/6":50,"2016/12/7":50,"2016/12/8":50,"2016/12/9":50,"2016/12/10":50,"2016/12/11":50,"2016/12/12":51,"2016/12/13":51,"2016/12/14":51,"2016/12/15":51,"2016/12/16":51,"2016/12/17":51,"2016/12/18":51,"2016/12/19":52,"2016/12/20":52,"2016/12/21":52,"2016/12/22":52,"2016/12/23":52,"2016/12/24":52,"2016/12/25":52,"2016/12/26":53,"2016/12/27":53,"2016/12/28":53,"2016/12/29":53,"2016/12/30":53,"2016/12/31":53,"2017/1/1":53,"2017/1/2":1,"2017/1/3":1,"2017/1/4":1,"2017/1/5":1,"2017/1/6":1,"2017/1/7":1,"2017/1/8":1,"2017/1/9":2,"2017/1/10":2,"2017/1/11":2,"2017/1/12":2,"2017/1/13":2,"2017/1/14":2,"2017/1/15":2,"2017/1/16":3,"2017/1/17":3,"2017/1/18":3,"2017/1/19":3,"2017/1/20":3,"2017/1/21":3,"2017/1/22":3,"2017/1/23":4,"2017/1/24":4,"2017/1/25":4,"2017/1/26":4,"2017/1/27":4,"2017/1/28":4,"2017/1/29":4,"2017/1/30":5,"2017/1/31":5,"2017/2/1":5,"2017/2/2":5,"2017/2/3":5,"2017/2/4":5,"2017/2/5":5,"2017/2/6":6,"2017/2/7":6,"2017/2/8":6,"2017/2/9":6,"2017/2/10":6,"2017/2/11":6,"2017/2/12":6,"2017/2/13":7,"2017/2/14":7,"2017/2/15":7,"2017/2/16":7,"2017/2/17":7,"2017/2/18":7,"2017/2/19":7,"2017/2/20":8,"2017/2/21":8,"2017/2/22":8,"2017/2/23":8,"2017/2/24":8,"2017/2/25":8,"2017/2/26":8,"2017/2/27":9,"2017/2/28":9,"2017/3/1":9,"2017/3/2":9,"2017/3/3":9,"2017/3/4":9,"2017/3/5":9,"2017/3/6":10,"2017/3/7":10,"2017/3/8":10,"2017/3/9":10,"2017/3/10":10,"2017/3/11":10,"2017/3/12":10,"2017/3/13":11,"2017/3/14":11,"2017/3/15":11,"2017/3/16":11,"2017/3/17":11,"2017/3/18":11,"2017/3/19":11,"2017/3/20":12,"2017/3/21":12,"2017/3/22":12,"2017/3/23":12,"2017/3/24":12,"2017/3/25":12,"2017/3/26":12,"2017/3/27":13,"2017/3/28":13,"2017/3/29":13,"2017/3/30":13,"2017/3/31":13,"2017/4/1":13,"2017/4/2":13,"2017/4/3":14,"2017/4/4":14,"2017/4/5":14,"2017/4/6":14,"2017/4/7":14,"2017/4/8":14,"2017/4/9":14,"2017/4/10":15,"2017/4/11":15,"2017/4/12":15,"2017/4/13":15,"2017/4/14":15,"2017/4/15":15,"2017/4/16":15,"2017/4/17":16,"2017/4/18":16,"2017/4/19":16,"2017/4/20":16,"2017/4/21":16,"2017/4/22":16,"2017/4/23":16,"2017/4/24":17,"2017/4/25":17,"2017/4/26":17,"2017/4/27":17,"2017/4/28":17,"2017/4/29":17,"2017/4/30":17,"2017/5/1":18,"2017/5/2":18,"2017/5/3":18,"2017/5/4":18,"2017/5/5":18,"2017/5/6":18,"2017/5/7":18,"2017/5/8":19,"2017/5/9":19,"2017/5/10":19,"2017/5/11":19,"2017/5/12":19,"2017/5/13":19,"2017/5/14":19,"2017/5/15":20,"2017/5/16":20,"2017/5/17":20,"2017/5/18":20,"2017/5/19":20,"2017/5/20":20,"2017/5/21":20,"2017/5/22":21,"2017/5/23":21,"2017/5/24":21,"2017/5/25":21,"2017/5/26":21,"2017/5/27":21,"2017/5/28":21,"2017/5/29":22,"2017/5/30":22,"2017/5/31":22,"2017/6/1":22,"2017/6/2":22,"2017/6/3":22,"2017/6/4":22,"2017/6/5":23,"2017/6/6":23,"2017/6/7":23,"2017/6/8":23,"2017/6/9":23,"2017/6/10":23,"2017/6/11":23,"2017/6/12":24,"2017/6/13":24,"2017/6/14":24,"2017/6/15":24,"2017/6/16":24,"2017/6/17":24,"2017/6/18":24,"2017/6/19":25,"2017/6/20":25,"2017/6/21":25,"2017/6/22":25,"2017/6/23":25,"2017/6/24":25,"2017/6/25":25,"2017/6/26":26,"2017/6/27":26,"2017/6/28":26,"2017/6/29":26,"2017/6/30":26,"2017/7/1":26,"2017/7/2":26,"2017/7/3":27,"2017/7/4":27,"2017/7/5":27,"2017/7/6":27,"2017/7/7":27,"2017/7/8":27,"2017/7/9":27,"2017/7/10":28,"2017/7/11":28,"2017/7/12":28,"2017/7/13":28,"2017/7/14":28,"2017/7/15":28,"2017/7/16":28,"2017/7/17":29,"2017/7/18":29,"2017/7/19":29,"2017/7/20":29,"2017/7/21":29,"2017/7/22":29,"2017/7/23":29,"2017/7/24":30,"2017/7/25":30,"2017/7/26":30,"2017/7/27":30,"2017/7/28":30,"2017/7/29":30,"2017/7/30":30,"2017/7/31":31,"2017/8/1":31,"2017/8/2":31,"2017/8/3":31,"2017/8/4":31,"2017/8/5":31,"2017/8/6":31,"2017/8/7":32,"2017/8/8":32,"2017/8/9":32,"2017/8/10":32,"2017/8/11":32,"2017/8/12":32,"2017/8/13":32,"2017/8/14":33,"2017/8/15":33,"2017/8/16":33,"2017/8/17":33,"2017/8/18":33,"2017/8/19":33,"2017/8/20":33,"2017/8/21":34,"2017/8/22":34,"2017/8/23":34,"2017/8/24":34,"2017/8/25":34,"2017/8/26":34,"2017/8/27":34,"2017/8/28":35,"2017/8/29":35,"2017/8/30":35,"2017/8/31":35,"2017/9/1":35,"2017/9/2":35,"2017/9/3":35,"2017/9/4":36,"2017/9/5":36,"2017/9/6":36,"2017/9/7":36,"2017/9/8":36,"2017/9/9":36,"2017/9/10":36,"2017/9/11":37,"2017/9/12":37,"2017/9/13":37,"2017/9/14":37,"2017/9/15":37,"2017/9/16":37,"2017/9/17":37,"2017/9/18":38,"2017/9/19":38,"2017/9/20":38,"2017/9/21":38,"2017/9/22":38,"2017/9/23":38,"2017/9/24":38,"2017/9/25":39,"2017/9/26":39,"2017/9/27":39,"2017/9/28":39,"2017/9/29":39,"2017/9/30":39,"2017/10/1":39,"2017/10/2":40,"2017/10/3":40,"2017/10/4":40,"2017/10/5":40,"2017/10/6":40,"2017/10/7":40,"2017/10/8":40,"2017/10/9":41,"2017/10/10":41,"2017/10/11":41,"2017/10/12":41,"2017/10/13":41,"2017/10/14":41,"2017/10/15":41,"2017/10/16":42,"2017/10/17":42,"2017/10/18":42,"2017/10/19":42,"2017/10/20":42,"2017/10/21":42,"2017/10/22":42,"2017/10/23":43,"2017/10/24":43,"2017/10/25":43,"2017/10/26":43,"2017/10/27":43,"2017/10/28":43,"2017/10/29":43,"2017/10/30":44,"2017/10/31":44,"2017/11/1":44,"2017/11/2":44,"2017/11/3":44,"2017/11/4":44,"2017/11/5":44,"2017/11/6":45,"2017/11/7":45,"2017/11/8":45,"2017/11/9":45,"2017/11/10":45,"2017/11/11":45,"2017/11/12":45,"2017/11/13":46,"2017/11/14":46,"2017/11/15":46,"2017/11/16":46,"2017/11/17":46,"2017/11/18":46,"2017/11/19":46,"2017/11/20":47,"2017/11/21":47,"2017/11/22":47,"2017/11/23":47,"2017/11/24":47,"2017/11/25":47,"2017/11/26":47,"2017/11/27":48,"2017/11/28":48,"2017/11/29":48,"2017/11/30":48,"2017/12/1":48,"2017/12/2":48,"2017/12/3":48,"2017/12/4":49,"2017/12/5":49,"2017/12/6":49,"2017/12/7":49,"2017/12/8":49,"2017/12/9":49,"2017/12/10":49,"2017/12/11":50,"2017/12/12":50,"2017/12/13":50,"2017/12/14":50,"2017/12/15":50,"2017/12/16":50,"2017/12/17":50,"2017/12/18":51,"2017/12/19":51,"2017/12/20":51,"2017/12/21":51,"2017/12/22":51,"2017/12/23":51,"2017/12/24":51,"2017/12/25":52,"2017/12/26":52,"2017/12/27":52,"2017/12/28":52,"2017/12/29":52,"2017/12/30":52,"2017/12/31":52,"2018/1/1":1,"2018/1/2":1,"2018/1/3":1,"2018/1/4":1,"2018/1/5":1,"2018/1/6":1,"2018/1/7":1,"2018/1/8":2,"2018/1/9":2,"2018/1/10":2,"2018/1/11":2,"2018/1/12":2,"2018/1/13":2,"2018/1/14":2,"2018/1/15":3,"2018/1/16":3,"2018/1/17":3,"2018/1/18":3,"2018/1/19":3,"2018/1/20":3,"2018/1/21":3,"2018/1/22":4,"2018/1/23":4,"2018/1/24":4,"2018/1/25":4,"2018/1/26":4,"2018/1/27":4,"2018/1/28":4,"2018/1/29":5,"2018/1/30":5,"2018/1/31":5,"2018/2/1":5,"2018/2/2":5,"2018/2/3":5,"2018/2/4":5,"2018/2/5":6,"2018/2/6":6,"2018/2/7":6,"2018/2/8":6,"2018/2/9":6,"2018/2/10":6,"2018/2/11":6,"2018/2/12":7,"2018/2/13":7,"2018/2/14":7,"2018/2/15":7,"2018/2/16":7,"2018/2/17":7,"2018/2/18":7,"2018/2/19":8,"2018/2/20":8,"2018/2/21":8,"2018/2/22":8,"2018/2/23":8,"2018/2/24":8,"2018/2/25":8,"2018/2/26":9,"2018/2/27":9,"2018/2/28":9,"2018/3/1":9,"2018/3/2":9,"2018/3/3":9,"2018/3/4":9,"2018/3/5":10,"2018/3/6":10,"2018/3/7":10,"2018/3/8":10,"2018/3/9":10,"2018/3/10":10,"2018/3/11":10,"2018/3/12":11,"2018/3/13":11,"2018/3/14":11,"2018/3/15":11,"2018/3/16":11,"2018/3/17":11,"2018/3/18":11,"2018/3/19":12,"2018/3/20":12,"2018/3/21":12,"2018/3/22":12,"2018/3/23":12,"2018/3/24":12,"2018/3/25":12,"2018/3/26":13,"2018/3/27":13,"2018/3/28":13,"2018/3/29":13,"2018/3/30":13,"2018/3/31":13,"2018/4/1":13,"2018/4/2":14,"2018/4/3":14,"2018/4/4":14,"2018/4/5":14,"2018/4/6":14,"2018/4/7":14,"2018/4/8":14,"2018/4/9":15,"2018/4/10":15,"2018/4/11":15,"2018/4/12":15,"2018/4/13":15,"2018/4/14":15,"2018/4/15":15,"2018/4/16":16,"2018/4/17":16,"2018/4/18":16,"2018/4/19":16,"2018/4/20":16,"2018/4/21":16,"2018/4/22":16,"2018/4/23":17,"2018/4/24":17,"2018/4/25":17,"2018/4/26":17,"2018/4/27":17,"2018/4/28":17,"2018/4/29":17,"2018/4/30":18,"2018/5/1":18,"2018/5/2":18,"2018/5/3":18,"2018/5/4":18,"2018/5/5":18,"2018/5/6":18,"2018/5/7":19,"2018/5/8":19,"2018/5/9":19,"2018/5/10":19,"2018/5/11":19,"2018/5/12":19,"2018/5/13":19,"2018/5/14":20,"2018/5/15":20,"2018/5/16":20,"2018/5/17":20,"2018/5/18":20,"2018/5/19":20,"2018/5/20":20,"2018/5/21":21,"2018/5/22":21,"2018/5/23":21,"2018/5/24":21,"2018/5/25":21,"2018/5/26":21,"2018/5/27":21,"2018/5/28":22,"2018/5/29":22,"2018/5/30":22,"2018/5/31":22,"2018/6/1":22,"2018/6/2":22,"2018/6/3":22,"2018/6/4":23,"2018/6/5":23,"2018/6/6":23,"2018/6/7":23,"2018/6/8":23,"2018/6/9":23,"2018/6/10":23,"2018/6/11":24,"2018/6/12":24,"2018/6/13":24,"2018/6/14":24,"2018/6/15":24,"2018/6/16":24,"2018/6/17":24,"2018/6/18":25,"2018/6/19":25,"2018/6/20":25,"2018/6/21":25,"2018/6/22":25,"2018/6/23":25,"2018/6/24":25,"2018/6/25":26,"2018/6/26":26,"2018/6/27":26,"2018/6/28":26,"2018/6/29":26,"2018/6/30":26,"2018/7/1":26,"2018/7/2":27,"2018/7/3":27,"2018/7/4":27,"2018/7/5":27,"2018/7/6":27,"2018/7/7":27,"2018/7/8":27,"2018/7/9":28,"2018/7/10":28,"2018/7/11":28,"2018/7/12":28,"2018/7/13":28,"2018/7/14":28,"2018/7/15":28,"2018/7/16":29,"2018/7/17":29,"2018/7/18":29,"2018/7/19":29,"2018/7/20":29,"2018/7/21":29,"2018/7/22":29,"2018/7/23":30,"2018/7/24":30,"2018/7/25":30,"2018/7/26":30,"2018/7/27":30,"2018/7/28":30,"2018/7/29":30,"2018/7/30":31,"2018/7/31":31,"2018/8/1":31,"2018/8/2":31,"2018/8/3":31,"2018/8/4":31,"2018/8/5":31,"2018/8/6":32,"2018/8/7":32,"2018/8/8":32,"2018/8/9":32,"2018/8/10":32,"2018/8/11":32,"2018/8/12":32,"2018/8/13":33,"2018/8/14":33,"2018/8/15":33,"2018/8/16":33,"2018/8/17":33,"2018/8/18":33,"2018/8/19":33,"2018/8/20":34,"2018/8/21":34,"2018/8/22":34,"2018/8/23":34,"2018/8/24":34,"2018/8/25":34,"2018/8/26":34,"2018/8/27":35,"2018/8/28":35,"2018/8/29":35,"2018/8/30":35,"2018/8/31":35,"2018/9/1":35,"2018/9/2":35,"2018/9/3":36,"2018/9/4":36,"2018/9/5":36,"2018/9/6":36,"2018/9/7":36,"2018/9/8":36,"2018/9/9":36,"2018/9/10":37,"2018/9/11":37,"2018/9/12":37,"2018/9/13":37,"2018/9/14":37,"2018/9/15":37,"2018/9/16":37,"2018/9/17":38,"2018/9/18":38,"2018/9/19":38,"2018/9/20":38,"2018/9/21":38,"2018/9/22":38,"2018/9/23":38,"2018/9/24":39,"2018/9/25":39,"2018/9/26":39,"2018/9/27":39,"2018/9/28":39,"2018/9/29":39,"2018/9/30":39,"2018/10/1":40,"2018/10/2":40,"2018/10/3":40,"2018/10/4":40,"2018/10/5":40,"2018/10/6":40,"2018/10/7":40,"2018/10/8":41,"2018/10/9":41,"2018/10/10":41,"2018/10/11":41,"2018/10/12":41,"2018/10/13":41,"2018/10/14":41,"2018/10/15":42,"2018/10/16":42,"2018/10/17":42,"2018/10/18":42,"2018/10/19":42,"2018/10/20":42,"2018/10/21":42,"2018/10/22":43,"2018/10/23":43,"2018/10/24":43,"2018/10/25":43,"2018/10/26":43,"2018/10/27":43,"2018/10/28":43,"2018/10/29":44,"2018/10/30":44,"2018/10/31":44,"2018/11/1":44,"2018/11/2":44,"2018/11/3":44,"2018/11/4":44,"2018/11/5":45,"2018/11/6":45,"2018/11/7":45,"2018/11/8":45,"2018/11/9":45,"2018/11/10":45,"2018/11/11":45,"2018/11/12":46,"2018/11/13":46,"2018/11/14":46,"2018/11/15":46,"2018/11/16":46,"2018/11/17":46,"2018/11/18":46,"2018/11/19":47,"2018/11/20":47,"2018/11/21":47,"2018/11/22":47,"2018/11/23":47,"2018/11/24":47,"2018/11/25":47,"2018/11/26":48,"2018/11/27":48,"2018/11/28":48,"2018/11/29":48,"2018/11/30":48,"2018/12/1":48,"2018/12/2":48,"2018/12/3":49,"2018/12/4":49,"2018/12/5":49,"2018/12/6":49,"2018/12/7":49,"2018/12/8":49,"2018/12/9":49,"2018/12/10":50,"2018/12/11":50,"2018/12/12":50,"2018/12/13":50,"2018/12/14":50,"2018/12/15":50,"2018/12/16":50,"2018/12/17":51,"2018/12/18":51,"2018/12/19":51,"2018/12/20":51,"2018/12/21":51,"2018/12/22":51,"2018/12/23":51,"2018/12/24":52,"2018/12/25":52,"2018/12/26":52,"2018/12/27":52,"2018/12/28":52,"2018/12/29":52,"2018/12/30":52,"2018/12/31":1,"2019/1/1":1,"2019/1/2":1,"2019/1/3":1,"2019/1/4":1,"2019/1/5":1,"2019/1/6":1,"2019/1/7":2,"2019/1/8":2,"2019/1/9":2,"2019/1/10":2,"2019/1/11":2,"2019/1/12":2,"2019/1/13":2,"2019/1/14":3,"2019/1/15":3,"2019/1/16":3,"2019/1/17":3,"2019/1/18":3,"2019/1/19":3,"2019/1/20":3,"2019/1/21":4,"2019/1/22":4,"2019/1/23":4,"2019/1/24":4,"2019/1/25":4,"2019/1/26":4,"2019/1/27":4,"2019/1/28":5,"2019/1/29":5,"2019/1/30":5,"2019/1/31":5,"2019/2/1":5,"2019/2/2":5,"2019/2/3":5,"2019/2/4":6,"2019/2/5":6,"2019/2/6":6,"2019/2/7":6,"2019/2/8":6,"2019/2/9":6,"2019/2/10":6,"2019/2/11":7,"2019/2/12":7,"2019/2/13":7,"2019/2/14":7,"2019/2/15":7,"2019/2/16":7,"2019/2/17":7,"2019/2/18":8,"2019/2/19":8,"2019/2/20":8,"2019/2/21":8,"2019/2/22":8,"2019/2/23":8,"2019/2/24":8,"2019/2/25":9,"2019/2/26":9,"2019/2/27":9,"2019/2/28":9,"2019/3/1":9,"2019/3/2":9,"2019/3/3":9,"2019/3/4":10,"2019/3/5":10,"2019/3/6":10,"2019/3/7":10,"2019/3/8":10,"2019/3/9":10,"2019/3/10":10,"2019/3/11":11,"2019/3/12":11,"2019/3/13":11,"2019/3/14":11,"2019/3/15":11,"2019/3/16":11,"2019/3/17":11,"2019/3/18":12,"2019/3/19":12,"2019/3/20":12,"2019/3/21":12,"2019/3/22":12,"2019/3/23":12,"2019/3/24":12,"2019/3/25":13,"2019/3/26":13,"2019/3/27":13,"2019/3/28":13,"2019/3/29":13,"2019/3/30":13,"2019/3/31":13,"2019/4/1":14,"2019/4/2":14,"2019/4/3":14,"2019/4/4":14,"2019/4/5":14,"2019/4/6":14,"2019/4/7":14,"2019/4/8":15,"2019/4/9":15,"2019/4/10":15,"2019/4/11":15,"2019/4/12":15,"2019/4/13":15,"2019/4/14":15,"2019/4/15":16,"2019/4/16":16,"2019/4/17":16,"2019/4/18":16,"2019/4/19":16,"2019/4/20":16,"2019/4/21":16,"2019/4/22":17,"2019/4/23":17,"2019/4/24":17,"2019/4/25":17,"2019/4/26":17,"2019/4/27":17,"2019/4/28":17,"2019/4/29":18,"2019/4/30":18,"2019/5/1":18,"2019/5/2":18,"2019/5/3":18,"2019/5/4":18,"2019/5/5":18,"2019/5/6":19,"2019/5/7":19,"2019/5/8":19,"2019/5/9":19,"2019/5/10":19,"2019/5/11":19,"2019/5/12":19,"2019/5/13":20,"2019/5/14":20,"2019/5/15":20,"2019/5/16":20,"2019/5/17":20,"2019/5/18":20,"2019/5/19":20,"2019/5/20":21,"2019/5/21":21,"2019/5/22":21,"2019/5/23":21,"2019/5/24":21,"2019/5/25":21,"2019/5/26":21,"2019/5/27":22,"2019/5/28":22,"2019/5/29":22,"2019/5/30":22,"2019/5/31":22,"2019/6/1":22,"2019/6/2":22,"2019/6/3":23,"2019/6/4":23,"2019/6/5":23,"2019/6/6":23,"2019/6/7":23,"2019/6/8":23,"2019/6/9":23,"2019/6/10":24,"2019/6/11":24,"2019/6/12":24,"2019/6/13":24,"2019/6/14":24,"2019/6/15":24,"2019/6/16":24,"2019/6/17":25,"2019/6/18":25,"2019/6/19":25,"2019/6/20":25,"2019/6/21":25,"2019/6/22":25,"2019/6/23":25,"2019/6/24":26,"2019/6/25":26,"2019/6/26":26,"2019/6/27":26,"2019/6/28":26,"2019/6/29":26,"2019/6/30":26,"2019/7/1":27,"2019/7/2":27,"2019/7/3":27,"2019/7/4":27,"2019/7/5":27,"2019/7/6":27,"2019/7/7":27,"2019/7/8":28,"2019/7/9":28,"2019/7/10":28,"2019/7/11":28,"2019/7/12":28,"2019/7/13":28,"2019/7/14":28,"2019/7/15":29,"2019/7/16":29,"2019/7/17":29,"2019/7/18":29,"2019/7/19":29,"2019/7/20":29,"2019/7/21":29,"2019/7/22":30,"2019/7/23":30,"2019/7/24":30,"2019/7/25":30,"2019/7/26":30,"2019/7/27":30,"2019/7/28":30,"2019/7/29":31,"2019/7/30":31,"2019/7/31":31,"2019/8/1":31,"2019/8/2":31,"2019/8/3":31,"2019/8/4":31,"2019/8/5":32,"2019/8/6":32,"2019/8/7":32,"2019/8/8":32,"2019/8/9":32,"2019/8/10":32,"2019/8/11":32,"2019/8/12":33,"2019/8/13":33,"2019/8/14":33,"2019/8/15":33,"2019/8/16":33,"2019/8/17":33,"2019/8/18":33,"2019/8/19":34,"2019/8/20":34,"2019/8/21":34,"2019/8/22":34,"2019/8/23":34,"2019/8/24":34,"2019/8/25":34,"2019/8/26":35,"2019/8/27":35,"2019/8/28":35,"2019/8/29":35,"2019/8/30":35,"2019/8/31":35,"2019/9/1":35,"2019/9/2":36,"2019/9/3":36,"2019/9/4":36,"2019/9/5":36,"2019/9/6":36,"2019/9/7":36,"2019/9/8":36,"2019/9/9":37,"2019/9/10":37,"2019/9/11":37,"2019/9/12":37,"2019/9/13":37,"2019/9/14":37,"2019/9/15":37,"2019/9/16":38,"2019/9/17":38,"2019/9/18":38,"2019/9/19":38,"2019/9/20":38,"2019/9/21":38,"2019/9/22":38,"2019/9/23":39,"2019/9/24":39,"2019/9/25":39,"2019/9/26":39,"2019/9/27":39,"2019/9/28":39,"2019/9/29":39,"2019/9/30":40,"2019/10/1":40,"2019/10/2":40,"2019/10/3":40,"2019/10/4":40,"2019/10/5":40,"2019/10/6":40,"2019/10/7":41,"2019/10/8":41,"2019/10/9":41,"2019/10/10":41,"2019/10/11":41,"2019/10/12":41,"2019/10/13":41,"2019/10/14":42,"2019/10/15":42,"2019/10/16":42,"2019/10/17":42,"2019/10/18":42,"2019/10/19":42,"2019/10/20":42,"2019/10/21":43,"2019/10/22":43,"2019/10/23":43,"2019/10/24":43,"2019/10/25":43,"2019/10/26":43,"2019/10/27":43,"2019/10/28":44,"2019/10/29":44,"2019/10/30":44,"2019/10/31":44,"2019/11/1":44,"2019/11/2":44,"2019/11/3":44,"2019/11/4":45,"2019/11/5":45,"2019/11/6":45,"2019/11/7":45,"2019/11/8":45,"2019/11/9":45,"2019/11/10":45,"2019/11/11":46,"2019/11/12":46,"2019/11/13":46,"2019/11/14":46,"2019/11/15":46,"2019/11/16":46,"2019/11/17":46,"2019/11/18":47,"2019/11/19":47,"2019/11/20":47,"2019/11/21":47,"2019/11/22":47,"2019/11/23":47,"2019/11/24":47,"2019/11/25":48,"2019/11/26":48,"2019/11/27":48,"2019/11/28":48,"2019/11/29":48,"2019/11/30":48,"2019/12/1":48,"2019/12/2":49,"2019/12/3":49,"2019/12/4":49,"2019/12/5":49,"2019/12/6":49,"2019/12/7":49,"2019/12/8":49,"2019/12/9":50,"2019/12/10":50,"2019/12/11":50,"2019/12/12":50,"2019/12/13":50,"2019/12/14":50,"2019/12/15":50,"2019/12/16":51,"2019/12/17":51,"2019/12/18":51,"2019/12/19":51,"2019/12/20":51,"2019/12/21":51,"2019/12/22":51,"2019/12/23":52,"2019/12/24":52,"2019/12/25":52,"2019/12/26":52,"2019/12/27":52,"2019/12/28":52,"2019/12/29":52,"2019/12/30":1,"2019/12/31":1,"2020/1/1":1,"2020/1/2":1,"2020/1/3":1,"2020/1/4":1,"2020/1/5":1,"2020/1/6":2,"2020/1/7":2,"2020/1/8":2,"2020/1/9":2,"2020/1/10":2,"2020/1/11":2,"2020/1/12":2,"2020/1/13":3,"2020/1/14":3,"2020/1/15":3,"2020/1/16":3,"2020/1/17":3,"2020/1/18":3,"2020/1/19":3,"2020/1/20":4,"2020/1/21":4,"2020/1/22":4,"2020/1/23":4,"2020/1/24":4,"2020/1/25":4,"2020/1/26":4,"2020/1/27":5,"2020/1/28":5,"2020/1/29":5,"2020/1/30":5,"2020/1/31":5,"2020/2/1":5,"2020/2/2":5,"2020/2/3":6,"2020/2/4":6,"2020/2/5":6,"2020/2/6":6,"2020/2/7":6,"2020/2/8":6,"2020/2/9":6,"2020/2/10":7,"2020/2/11":7,"2020/2/12":7,"2020/2/13":7,"2020/2/14":7,"2020/2/15":7,"2020/2/16":7,"2020/2/17":8,"2020/2/18":8,"2020/2/19":8,"2020/2/20":8,"2020/2/21":8,"2020/2/22":8,"2020/2/23":8,"2020/2/24":9,"2020/2/25":9,"2020/2/26":9,"2020/2/27":9,"2020/2/28":9,"2020/2/29":9,"2020/3/1":9,"2020/3/2":10,"2020/3/3":10,"2020/3/4":10,"2020/3/5":10,"2020/3/6":10,"2020/3/7":10,"2020/3/8":10,"2020/3/9":11,"2020/3/10":11,"2020/3/11":11,"2020/3/12":11,"2020/3/13":11,"2020/3/14":11,"2020/3/15":11,"2020/3/16":12,"2020/3/17":12,"2020/3/18":12,"2020/3/19":12,"2020/3/20":12,"2020/3/21":12,"2020/3/22":12,"2020/3/23":13,"2020/3/24":13,"2020/3/25":13,"2020/3/26":13,"2020/3/27":13,"2020/3/28":13,"2020/3/29":13,"2020/3/30":14,"2020/3/31":14,"2020/4/1":14,"2020/4/2":14,"2020/4/3":14,"2020/4/4":14,"2020/4/5":14,"2020/4/6":15,"2020/4/7":15,"2020/4/8":15,"2020/4/9":15,"2020/4/10":15,"2020/4/11":15,"2020/4/12":15,"2020/4/13":16,"2020/4/14":16,"2020/4/15":16,"2020/4/16":16,"2020/4/17":16,"2020/4/18":16,"2020/4/19":16,"2020/4/20":17,"2020/4/21":17,"2020/4/22":17,"2020/4/23":17,"2020/4/24":17,"2020/4/25":17,"2020/4/26":17,"2020/4/27":18,"2020/4/28":18,"2020/4/29":18,"2020/4/30":18,"2020/5/1":18,"2020/5/2":18,"2020/5/3":18,"2020/5/4":19,"2020/5/5":19,"2020/5/6":19,"2020/5/7":19,"2020/5/8":19,"2020/5/9":19,"2020/5/10":19,"2020/5/11":20,"2020/5/12":20,"2020/5/13":20,"2020/5/14":20,"2020/5/15":20,"2020/5/16":20,"2020/5/17":20,"2020/5/18":21,"2020/5/19":21,"2020/5/20":21,"2020/5/21":21,"2020/5/22":21,"2020/5/23":21,"2020/5/24":21,"2020/5/25":22,"2020/5/26":22,"2020/5/27":22,"2020/5/28":22,"2020/5/29":22,"2020/5/30":22,"2020/5/31":22,"2020/6/1":23,"2020/6/2":23,"2020/6/3":23,"2020/6/4":23,"2020/6/5":23,"2020/6/6":23,"2020/6/7":23,"2020/6/8":24,"2020/6/9":24,"2020/6/10":24,"2020/6/11":24,"2020/6/12":24,"2020/6/13":24,"2020/6/14":24,"2020/6/15":25,"2020/6/16":25,"2020/6/17":25,"2020/6/18":25,"2020/6/19":25,"2020/6/20":25,"2020/6/21":25,"2020/6/22":26,"2020/6/23":26,"2020/6/24":26,"2020/6/25":26,"2020/6/26":26,"2020/6/27":26,"2020/6/28":26,"2020/6/29":27,"2020/6/30":27,"2020/7/1":27,"2020/7/2":27,"2020/7/3":27,"2020/7/4":27,"2020/7/5":27,"2020/7/6":28,"2020/7/7":28,"2020/7/8":28,"2020/7/9":28,"2020/7/10":28,"2020/7/11":28,"2020/7/12":28,"2020/7/13":29,"2020/7/14":29,"2020/7/15":29,"2020/7/16":29,"2020/7/17":29,"2020/7/18":29,"2020/7/19":29,"2020/7/20":30,"2020/7/21":30,"2020/7/22":30,"2020/7/23":30,"2020/7/24":30,"2020/7/25":30,"2020/7/26":30,"2020/7/27":31,"2020/7/28":31,"2020/7/29":31,"2020/7/30":31,"2020/7/31":31,"2020/8/1":31,"2020/8/2":31,"2020/8/3":32,"2020/8/4":32,"2020/8/5":32,"2020/8/6":32,"2020/8/7":32,"2020/8/8":32,"2020/8/9":32,"2020/8/10":33,"2020/8/11":33,"2020/8/12":33,"2020/8/13":33,"2020/8/14":33,"2020/8/15":33,"2020/8/16":33,"2020/8/17":34,"2020/8/18":34,"2020/8/19":34,"2020/8/20":34,"2020/8/21":34,"2020/8/22":34,"2020/8/23":34,"2020/8/24":35,"2020/8/25":35,"2020/8/26":35,"2020/8/27":35,"2020/8/28":35,"2020/8/29":35,"2020/8/30":35,"2020/8/31":36,"2020/9/1":36,"2020/9/2":36,"2020/9/3":36,"2020/9/4":36,"2020/9/5":36,"2020/9/6":36,"2020/9/7":37,"2020/9/8":37,"2020/9/9":37,"2020/9/10":37,"2020/9/11":37,"2020/9/12":37,"2020/9/13":37,"2020/9/14":38,"2020/9/15":38,"2020/9/16":38,"2020/9/17":38,"2020/9/18":38,"2020/9/19":38,"2020/9/20":38,"2020/9/21":39,"2020/9/22":39,"2020/9/23":39,"2020/9/24":39,"2020/9/25":39,"2020/9/26":39,"2020/9/27":39,"2020/9/28":40,"2020/9/29":40,"2020/9/30":40,"2020/10/1":40,"2020/10/2":40,"2020/10/3":40,"2020/10/4":40,"2020/10/5":41,"2020/10/6":41,"2020/10/7":41,"2020/10/8":41,"2020/10/9":41,"2020/10/10":41,"2020/10/11":41,"2020/10/12":42,"2020/10/13":42,"2020/10/14":42,"2020/10/15":42,"2020/10/16":42,"2020/10/17":42,"2020/10/18":42,"2020/10/19":43,"2020/10/20":43,"2020/10/21":43,"2020/10/22":43,"2020/10/23":43,"2020/10/24":43,"2020/10/25":43,"2020/10/26":44,"2020/10/27":44,"2020/10/28":44,"2020/10/29":44,"2020/10/30":44,"2020/10/31":44,"2020/11/1":44,"2020/11/2":45,"2020/11/3":45,"2020/11/4":45,"2020/11/5":45,"2020/11/6":45,"2020/11/7":45,"2020/11/8":45,"2020/11/9":46,"2020/11/10":46,"2020/11/11":46,"2020/11/12":46,"2020/11/13":46,"2020/11/14":46,"2020/11/15":46,"2020/11/16":47,"2020/11/17":47,"2020/11/18":47,"2020/11/19":47,"2020/11/20":47,"2020/11/21":47,"2020/11/22":47,"2020/11/23":48,"2020/11/24":48,"2020/11/25":48,"2020/11/26":48,"2020/11/27":48,"2020/11/28":48,"2020/11/29":48,"2020/11/30":49,"2020/12/1":49,"2020/12/2":49,"2020/12/3":49,"2020/12/4":49,"2020/12/5":49,"2020/12/6":49,"2020/12/7":50,"2020/12/8":50,"2020/12/9":50,"2020/12/10":50,"2020/12/11":50,"2020/12/12":50,"2020/12/13":50,"2020/12/14":51,"2020/12/15":51,"2020/12/16":51,"2020/12/17":51,"2020/12/18":51,"2020/12/19":51,"2020/12/20":51,"2020/12/21":52,"2020/12/22":52,"2020/12/23":52,"2020/12/24":52,"2020/12/25":52,"2020/12/26":52,"2020/12/27":52,"2020/12/28":53,"2020/12/29":53,"2020/12/30":53,"2020/12/31":53,"2021/1/1":53,"2021/1/2":53,"2021/1/3":53,"2021/1/4":1,"2021/1/5":1,"2021/1/6":1,"2021/1/7":1,"2021/1/8":1,"2021/1/9":1,"2021/1/10":1,"2021/1/11":2,"2021/1/12":2,"2021/1/13":2,"2021/1/14":2,"2021/1/15":2,"2021/1/16":2,"2021/1/17":2,"2021/1/18":3,"2021/1/19":3,"2021/1/20":3,"2021/1/21":3,"2021/1/22":3,"2021/1/23":3,"2021/1/24":3,"2021/1/25":4,"2021/1/26":4,"2021/1/27":4,"2021/1/28":4,"2021/1/29":4,"2021/1/30":4,"2021/1/31":4,"2021/2/1":5,"2021/2/2":5,"2021/2/3":5,"2021/2/4":5,"2021/2/5":5,"2021/2/6":5,"2021/2/7":5,"2021/2/8":6,"2021/2/9":6,"2021/2/10":6,"2021/2/11":6,"2021/2/12":6,"2021/2/13":6,"2021/2/14":6,"2021/2/15":7,"2021/2/16":7,"2021/2/17":7,"2021/2/18":7,"2021/2/19":7,"2021/2/20":7,"2021/2/21":7,"2021/2/22":8,"2021/2/23":8,"2021/2/24":8,"2021/2/25":8,"2021/2/26":8,"2021/2/27":8,"2021/2/28":8,"2021/3/1":9,"2021/3/2":9,"2021/3/3":9,"2021/3/4":9,"2021/3/5":9,"2021/3/6":9,"2021/3/7":9,"2021/3/8":10,"2021/3/9":10,"2021/3/10":10,"2021/3/11":10,"2021/3/12":10,"2021/3/13":10,"2021/3/14":10,"2021/3/15":11,"2021/3/16":11,"2021/3/17":11,"2021/3/18":11,"2021/3/19":11,"2021/3/20":11,"2021/3/21":11,"2021/3/22":12,"2021/3/23":12,"2021/3/24":12,"2021/3/25":12,"2021/3/26":12,"2021/3/27":12,"2021/3/28":12,"2021/3/29":13,"2021/3/30":13,"2021/3/31":13}; 
	// 获取当前周
	this.getWeekOfYear = function(today){
	  var firstDay = new Date(today.getFullYear(),0, 1);
	  var dayOfWeek = firstDay.getDay(); 
	  var spendDay= 1;
	  if (dayOfWeek !=0) {
	    spendDay=7-dayOfWeek+1;
	  }
	  firstDay = new Date(today.getFullYear(),0, 1+spendDay);
	  var d =Math.ceil((today.valueOf()- firstDay.valueOf())/ 86400000);
	  var result =Math.ceil(d/7);
	  return result+1;
	};
	
    var that = this;

    this.element = $(element);

    // add container for single page application
    // when page switch the datetimepicker div will be removed also.
    this.container = options.container || 'body';

    this.language = options.language || this.element.data('date-language') || 'en';
    this.language = this.language in dates ? this.language : this.language.split('-')[0]; // fr-CA fallback to fr
    this.language = this.language in dates ? this.language : 'en';
    this.isRTL = dates[this.language].rtl || false;
    this.formatType = options.formatType || this.element.data('format-type') || 'standard';
    this.format = DPGlobal.parseFormat(options.format || this.element.data('date-format') || dates[this.language].format || DPGlobal.getDefaultFormat(this.formatType, 'input'), this.formatType);
    this.isInline = false;
    this.isVisible = false;
    this.isInput = this.element.is('input');
    this.fontAwesome = options.fontAwesome || this.element.data('font-awesome') || false;

    this.bootcssVer = options.bootcssVer || (this.isInput ? (this.element.is('.form-control') ? 3 : 2) : ( this.bootcssVer = this.element.is('.input-group') ? 3 : 2 ));

    this.component = this.element.is('.date') ? ( this.bootcssVer === 3 ? this.element.find('.input-group-addon .glyphicon-th, .input-group-addon .glyphicon-time, .input-group-addon .glyphicon-remove, .input-group-addon .glyphicon-calendar, .input-group-addon .fa-calendar, .input-group-addon .fa-clock-o').parent() : this.element.find('.add-on .icon-th, .add-on .icon-time, .add-on .icon-calendar, .add-on .fa-calendar, .add-on .fa-clock-o').parent()) : false;
    this.componentReset = this.element.is('.date') ? ( this.bootcssVer === 3 ? this.element.find('.input-group-addon .glyphicon-remove, .input-group-addon .fa-times').parent():this.element.find('.add-on .icon-remove, .add-on .fa-times').parent()) : false;
    this.hasInput = this.component && this.element.find('input').length;
    if (this.component && this.component.length === 0) {
      this.component = false;
    }
    this.linkField = options.linkField || this.element.data('link-field') || false;
    this.linkFormat = DPGlobal.parseFormat(options.linkFormat || this.element.data('link-format') || DPGlobal.getDefaultFormat(this.formatType, 'link'), this.formatType);
    this.minuteStep = options.minuteStep || this.element.data('minute-step') || 5;
    this.pickerPosition = options.pickerPosition || this.element.data('picker-position') || 'bottom-right';
    this.showMeridian = options.showMeridian || this.element.data('show-meridian') || false;
    this.initialDate = options.initialDate || new Date();
    this.zIndex = options.zIndex || this.element.data('z-index') || undefined;
    this.title = typeof options.title === 'undefined' ? false : options.title;
    this.timezone = options.timezone || timeZoneAbbreviation();

    this.icons = {
      leftArrow: this.fontAwesome ? 'fa-arrow-left' : (this.bootcssVer === 3 ? 'glyphicon-arrow-left' : 'icon-arrow-left'),
      rightArrow: this.fontAwesome ? 'fa-arrow-right' : (this.bootcssVer === 3 ? 'glyphicon-arrow-right' : 'icon-arrow-right')
    }
    this.icontype = this.fontAwesome ? 'fa' : 'glyphicon';

    this._attachEvents();

    this.clickedOutside = function (e) {
        // Clicked outside the datetimepicker, hide it
        if ($(e.target).closest('.datetimepicker').length === 0) {
            that.hide();
        }
    }

    this.formatViewType = 'datetime';
    if ('formatViewType' in options) {
      this.formatViewType = options.formatViewType;
    } else if ('formatViewType' in this.element.data()) {
      this.formatViewType = this.element.data('formatViewType');
    }

    this.minView = 0;
    if ('minView' in options) {
      this.minView = options.minView;
    } else if ('minView' in this.element.data()) {
      this.minView = this.element.data('min-view');
    }
    this.minView = DPGlobal.convertViewMode(this.minView);

    this.maxView = DPGlobal.modes.length - 1;
    if ('maxView' in options) {
      this.maxView = options.maxView;
    } else if ('maxView' in this.element.data()) {
      this.maxView = this.element.data('max-view');
    }
    this.maxView = DPGlobal.convertViewMode(this.maxView);

    this.wheelViewModeNavigation = false;
    if ('wheelViewModeNavigation' in options) {
      this.wheelViewModeNavigation = options.wheelViewModeNavigation;
    } else if ('wheelViewModeNavigation' in this.element.data()) {
      this.wheelViewModeNavigation = this.element.data('view-mode-wheel-navigation');
    }

    this.wheelViewModeNavigationInverseDirection = false;

    if ('wheelViewModeNavigationInverseDirection' in options) {
      this.wheelViewModeNavigationInverseDirection = options.wheelViewModeNavigationInverseDirection;
    } else if ('wheelViewModeNavigationInverseDirection' in this.element.data()) {
      this.wheelViewModeNavigationInverseDirection = this.element.data('view-mode-wheel-navigation-inverse-dir');
    }

    this.wheelViewModeNavigationDelay = 100;
    if ('wheelViewModeNavigationDelay' in options) {
      this.wheelViewModeNavigationDelay = options.wheelViewModeNavigationDelay;
    } else if ('wheelViewModeNavigationDelay' in this.element.data()) {
      this.wheelViewModeNavigationDelay = this.element.data('view-mode-wheel-navigation-delay');
    }

    this.startViewMode = 2;
    if ('startView' in options) {
      this.startViewMode = options.startView;
    } else if ('startView' in this.element.data()) {
      this.startViewMode = this.element.data('start-view');
    }
    this.startViewMode = DPGlobal.convertViewMode(this.startViewMode);
    this.viewMode = this.startViewMode;

    this.viewSelect = this.minView;
    if ('viewSelect' in options) {
      this.viewSelect = options.viewSelect;
    } else if ('viewSelect' in this.element.data()) {
      this.viewSelect = this.element.data('view-select');
    }
    this.viewSelect = DPGlobal.convertViewMode(this.viewSelect);

    this.forceParse = true;
    if ('forceParse' in options) {
      this.forceParse = options.forceParse;
    } else if ('dateForceParse' in this.element.data()) {
      this.forceParse = this.element.data('date-force-parse');
    }
    var template = this.bootcssVer === 3 ? DPGlobal.templateV3 : DPGlobal.template;
    while (template.indexOf('{iconType}') !== -1) {
      template = template.replace('{iconType}', this.icontype);
    }
    while (template.indexOf('{leftArrow}') !== -1) {
      template = template.replace('{leftArrow}', this.icons.leftArrow);
    }
    while (template.indexOf('{rightArrow}') !== -1) {
      template = template.replace('{rightArrow}', this.icons.rightArrow);
    }
    this.picker = $(template)
      .appendTo(this.isInline ? this.element : this.container) // 'body')
      .on({
        click:     $.proxy(this.click, this),
        mousedown: $.proxy(this.mousedown, this)
      });

    if (this.wheelViewModeNavigation) {
      if ($.fn.mousewheel) {
        this.picker.on({mousewheel: $.proxy(this.mousewheel, this)});
      } else {
        console.log('Mouse Wheel event is not supported. Please include the jQuery Mouse Wheel plugin before enabling this option');
      }
    }

    if (this.isInline) {
      this.picker.addClass('datetimepicker-inline');
    } else {
      this.picker.addClass('datetimepicker-dropdown-' + this.pickerPosition + ' dropdown-menu');
    }
    if (this.isRTL) {
      this.picker.addClass('datetimepicker-rtl');
      var selector = this.bootcssVer === 3 ? '.prev span, .next span' : '.prev i, .next i';
      this.picker.find(selector).toggleClass(this.icons.leftArrow + ' ' + this.icons.rightArrow);
    }

    $(document).on('mousedown touchend', this.clickedOutside);

    this.autoclose = false;
    if ('autoclose' in options) {
      this.autoclose = options.autoclose;
    } else if ('dateAutoclose' in this.element.data()) {
      this.autoclose = this.element.data('date-autoclose');
    }

	// 默认隐藏周显示
	this.weekShow = false;
    if ('weekShow' in options) {
      this.weekShow = options.weekShow;
    }
	
    this.keyboardNavigation = true;
    if ('keyboardNavigation' in options) {
      this.keyboardNavigation = options.keyboardNavigation;
    } else if ('dateKeyboardNavigation' in this.element.data()) {
      this.keyboardNavigation = this.element.data('date-keyboard-navigation');
    }

    this.todayBtn = (options.todayBtn || this.element.data('date-today-btn') || false);
    this.clearBtn = (options.clearBtn || this.element.data('date-clear-btn') || false);
    this.todayHighlight = (options.todayHighlight || this.element.data('date-today-highlight') || false);

    this.weekStart = 0;
    if (typeof options.weekStart !== 'undefined') {
      this.weekStart = options.weekStart;
    } else if (typeof this.element.data('date-weekstart') !== 'undefined') {
      this.weekStart = this.element.data('date-weekstart');
    } else if (typeof dates[this.language].weekStart !== 'undefined') {
      this.weekStart = dates[this.language].weekStart;
    }
    this.weekStart = this.weekStart % 7;
    this.weekEnd = ((this.weekStart + 6) % 7);
    this.onRenderDay = function (date) {
      var render = (options.onRenderDay || function () { return []; })(date);
      if (typeof render === 'string') {
        render = [render];
      }
      var res = ['day'];
      return res.concat((render ? render : []));
    };
    this.onRenderHour = function (date) {
      var render = (options.onRenderHour || function () { return []; })(date);
      var res = ['hour'];
      if (typeof render === 'string') {
        render = [render];
      }
      return res.concat((render ? render : []));
    };
    this.onRenderMinute = function (date) {
      var render = (options.onRenderMinute || function () { return []; })(date);
      var res = ['minute'];
      if (typeof render === 'string') {
        render = [render];
      }
      if (date < this.startDate || date > this.endDate) {
        res.push('disabled');
      } else if (Math.floor(this.date.getUTCMinutes() / this.minuteStep) === Math.floor(date.getUTCMinutes() / this.minuteStep)) {
        res.push('active');
      }
      return res.concat((render ? render : []));
    };
    this.onRenderYear = function (date) {
      var render = (options.onRenderYear || function () { return []; })(date);
      var res = ['year'];
      if (typeof render === 'string') {
        render = [render];
      }
      if (this.date.getUTCFullYear() === date.getUTCFullYear()) {
        res.push('active');
      }
      var currentYear = date.getUTCFullYear();
      var endYear = this.endDate.getUTCFullYear();
      if (date < this.startDate || currentYear > endYear) {
        res.push('disabled');
      }
      return res.concat((render ? render : []));
    }
    this.onRenderMonth = function (date) {
      var render = (options.onRenderMonth || function () { return []; })(date);
      var res = ['month'];
      if (typeof render === 'string') {
        render = [render];
      }
      return res.concat((render ? render : []));
    }
    this.startDate = new Date(-8639968443048000);
    this.endDate = new Date(8639968443048000);
    this.datesDisabled = [];
    this.daysOfWeekDisabled = [];
    this.setStartDate(options.startDate || this.element.data('date-startdate'));
    this.setEndDate(options.endDate || this.element.data('date-enddate'));
    this.setDatesDisabled(options.datesDisabled || this.element.data('date-dates-disabled'));
    this.setDaysOfWeekDisabled(options.daysOfWeekDisabled || this.element.data('date-days-of-week-disabled'));
    this.setMinutesDisabled(options.minutesDisabled || this.element.data('date-minute-disabled'));
    this.setHoursDisabled(options.hoursDisabled || this.element.data('date-hour-disabled'));
    this.fillDow();
    this.fillMonths();
    this.update();
    this.showMode();

    if (this.isInline) {
      this.show();
    }
  };

  Datetimepicker.prototype = {
    constructor: Datetimepicker,

    _events:       [],
    _attachEvents: function () {
      this._detachEvents();
      if (this.isInput) { // single input
        this._events = [
          [this.element, {
            focus:   $.proxy(this.show, this),
            keyup:   $.proxy(this.update, this),
            keydown: $.proxy(this.keydown, this)
          }]
        ];
      }
      else if (this.component && this.hasInput) { // component: input + button
        this._events = [
          // For components that are not readonly, allow keyboard nav
          [this.element.find('input'), {
            focus:   $.proxy(this.show, this),
            keyup:   $.proxy(this.update, this),
            keydown: $.proxy(this.keydown, this)
          }],
          [this.component, {
            click: $.proxy(this.show, this)
          }]
        ];
        if (this.componentReset) {
          this._events.push([
            this.componentReset,
            {click: $.proxy(this.reset, this)}
          ]);
        }
      }
      else if (this.element.is('div')) {  // inline datetimepicker
        this.isInline = true;
      }
      else {
        this._events = [
          [this.element, {
            click: $.proxy(this.show, this)
          }]
        ];
      }
      for (var i = 0, el, ev; i < this._events.length; i++) {
        el = this._events[i][0];
        ev = this._events[i][1];
        el.on(ev);
      }
    },

    _detachEvents: function () {
      for (var i = 0, el, ev; i < this._events.length; i++) {
        el = this._events[i][0];
        ev = this._events[i][1];
        el.off(ev);
      }
      this._events = [];
    },

    show: function (e) {
      this.picker.show();
      this.height = this.component ? this.component.outerHeight() : this.element.outerHeight();
      if (this.forceParse) {
        this.update();
      }
      this.place();
      $(window).on('resize', $.proxy(this.place, this));
      if (e) {
        e.stopPropagation();
        e.preventDefault();
      }
      this.isVisible = true;
      this.element.trigger({
        type: 'show',
        date: this.date
      });
    },

    hide: function () {
      if (!this.isVisible) return;
      if (this.isInline) return;
      this.picker.hide();
      $(window).off('resize', this.place);
      this.viewMode = this.startViewMode;
      this.showMode();
      if (!this.isInput) {
        $(document).off('mousedown', this.hide);
      }

      if (
        this.forceParse &&
          (
            this.isInput && this.element.val() ||
              this.hasInput && this.element.find('input').val()
            )
        )
        this.setValue();
      this.isVisible = false;
      this.element.trigger({
        type: 'hide',
        date: this.date
      });
    },

    remove: function () {
      this._detachEvents();
      $(document).off('mousedown', this.clickedOutside);
      this.picker.remove();
      delete this.picker;
      delete this.element.data().datetimepicker;
    },

    getDate: function () {
      var d = this.getUTCDate();
      if (d === null) {
        return null;
      }
      return new Date(d.getTime() + (d.getTimezoneOffset() * 60000));
    },

    getUTCDate: function () {
      return this.date;
    },

    getInitialDate: function () {
      return this.initialDate
    },

    setInitialDate: function (initialDate) {
      this.initialDate = initialDate;
    },

    setDate: function (d) {
      this.setUTCDate(new Date(d.getTime() - (d.getTimezoneOffset() * 60000)));
    },

    setUTCDate: function (d) {
      if (d >= this.startDate && d <= this.endDate) {
        this.date = d;
        this.setValue();
        this.viewDate = this.date;
        this.fill();
      } else {
        this.element.trigger({
          type:      'outOfRange',
          date:      d,
          startDate: this.startDate,
          endDate:   this.endDate
        });
      }
    },

    setFormat: function (format) {
      this.format = DPGlobal.parseFormat(format, this.formatType);
      var element;
      if (this.isInput) {
        element = this.element;
      } else if (this.component) {
        element = this.element.find('input');
      }
      if (element && element.val()) {
        this.setValue();
      }
    },

    setValue: function () {
      var formatted = this.getFormattedDate();
      if (!this.isInput) {
        if (this.component) {
          this.element.find('input').val(formatted);
        }
        this.element.data('date', formatted);
      } else {
        this.element.val(formatted);
      }
      if (this.linkField) {
        $('#' + this.linkField).val(this.getFormattedDate(this.linkFormat));
      }
    },

    getFormattedDate: function (format) {
      format = format || this.format;
      return DPGlobal.formatDate(this.date, format, this.language, this.formatType, this.timezone);
    },

    setStartDate: function (startDate) {
      this.startDate = startDate || this.startDate;
      if (this.startDate.valueOf() !== 8639968443048000) {
        this.startDate = DPGlobal.parseDate(this.startDate, this.format, this.language, this.formatType, this.timezone);
      }
      this.update();
      this.updateNavArrows();
    },

    setEndDate: function (endDate) {
      this.endDate = endDate || this.endDate;
      if (this.endDate.valueOf() !== 8639968443048000) {
        this.endDate = DPGlobal.parseDate(this.endDate, this.format, this.language, this.formatType, this.timezone);
      }
      this.update();
      this.updateNavArrows();
    },

    setDatesDisabled: function (datesDisabled) {
      this.datesDisabled = datesDisabled || [];
      if (!$.isArray(this.datesDisabled)) {
        this.datesDisabled = this.datesDisabled.split(/,\s*/);
      }
      var mThis = this;
      this.datesDisabled = $.map(this.datesDisabled, function (d) {
        return DPGlobal.parseDate(d, mThis.format, mThis.language, mThis.formatType, mThis.timezone).toDateString();
      });
      this.update();
      this.updateNavArrows();
    },

    setTitle: function (selector, value) {
      return this.picker.find(selector)
        .find('th:eq(1)')
        .text(this.title === false ? value : this.title);
    },

    setDaysOfWeekDisabled: function (daysOfWeekDisabled) {
      this.daysOfWeekDisabled = daysOfWeekDisabled || [];
      if (!$.isArray(this.daysOfWeekDisabled)) {
        this.daysOfWeekDisabled = this.daysOfWeekDisabled.split(/,\s*/);
      }
      this.daysOfWeekDisabled = $.map(this.daysOfWeekDisabled, function (d) {
        return parseInt(d, 10);
      });
      this.update();
      this.updateNavArrows();
    },

    setMinutesDisabled: function (minutesDisabled) {
      this.minutesDisabled = minutesDisabled || [];
      if (!$.isArray(this.minutesDisabled)) {
        this.minutesDisabled = this.minutesDisabled.split(/,\s*/);
      }
      this.minutesDisabled = $.map(this.minutesDisabled, function (d) {
        return parseInt(d, 10);
      });
      this.update();
      this.updateNavArrows();
    },

    setHoursDisabled: function (hoursDisabled) {
      this.hoursDisabled = hoursDisabled || [];
      if (!$.isArray(this.hoursDisabled)) {
        this.hoursDisabled = this.hoursDisabled.split(/,\s*/);
      }
      this.hoursDisabled = $.map(this.hoursDisabled, function (d) {
        return parseInt(d, 10);
      });
      this.update();
      this.updateNavArrows();
    },

    place: function () {
      if (this.isInline) return;

      if (!this.zIndex) {
        var index_highest = 0;
        $('div').each(function () {
          var index_current = parseInt($(this).css('zIndex'), 10);
          if (index_current > index_highest) {
            index_highest = index_current;
          }
        });
        this.zIndex = index_highest + 10;
      }

      var offset, top, left, containerOffset;
      if (this.container instanceof $) {
        containerOffset = this.container.offset();
      } else {
        containerOffset = $(this.container).offset();
      }

      if (this.component) {
        offset = this.component.offset();
        left = offset.left;
        if (this.pickerPosition === 'bottom-left' || this.pickerPosition === 'top-left') {
          left += this.component.outerWidth() - this.picker.outerWidth();
        }
      } else {
        offset = this.element.offset();
        left = offset.left;
        if (this.pickerPosition === 'bottom-left' || this.pickerPosition === 'top-left') {
          left += this.element.outerWidth() - this.picker.outerWidth();
        }
      }

      var bodyWidth = document.body.clientWidth || window.innerWidth;
      if (left + 220 > bodyWidth) {
        left = bodyWidth - 220;
      }

      if (this.pickerPosition === 'top-left' || this.pickerPosition === 'top-right') {
        top = offset.top - this.picker.outerHeight();
      } else {
        top = offset.top + this.height;
      }

      top = top - containerOffset.top;
      left = left - containerOffset.left;

      this.picker.css({
        top:    top,
        left:   left,
        zIndex: this.zIndex
      });
    },

    hour_minute: "^([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]",

    update: function () {
      var date, fromArgs = false;
      if (arguments && arguments.length && (typeof arguments[0] === 'string' || arguments[0] instanceof Date)) {
        date = arguments[0];
        fromArgs = true;
      } else {
        date = (this.isInput ? this.element.val() : this.element.find('input').val()) || this.element.data('date') || this.initialDate;
        if (typeof date === 'string') {
          date = date.replace(/^\s+|\s+$/g,'');
        }
      }

      if (!date) {
        date = new Date();
        fromArgs = false;
      }

      if (typeof date === "string") {
        if (new RegExp(this.hour_minute).test(date) || new RegExp(this.hour_minute + ":[0-5][0-9]").test(date)) {
          date = this.getDate()
        }
      }

      this.date = DPGlobal.parseDate(date, this.format, this.language, this.formatType, this.timezone);

      if (fromArgs) this.setValue();

      if (this.date < this.startDate) {
        this.viewDate = new Date(this.startDate);
      } else if (this.date > this.endDate) {
        this.viewDate = new Date(this.endDate);
      } else {
        this.viewDate = new Date(this.date);
      }
      this.fill();
    },

    fillDow: function () {
      var dowCnt = this.weekStart,
        html = '<tr>';
	  //显示周
	  if( this.weekShow ){
		  html += '<th>&nbsp;</th>';
		  //tre-date-switch
		  debugger;
		  var _this = this;
		  setTimeout(function(){
			  debugger;
			   _this.picker.find('.datetimepicker-days thead [name="tre-date-switch"]')[0].setAttribute('colspan',6);
		  }, 0 )
	  }
      while (dowCnt < this.weekStart + 7) {
        html += '<th class="dow">' + dates[this.language].daysMin[(dowCnt++) % 7] + '</th>';
      }
	  
      html += '</tr>';
      this.picker.find('.datetimepicker-days thead').append(html);
    },

    fillMonths: function () {
      var html = '';
      var d = new Date(this.viewDate);
      for (var i = 0; i < 12; i++) {
        d.setUTCMonth(i);
        var classes = this.onRenderMonth(d);
        html += '<span class="' + classes.join(' ') + '">' + dates[this.language].monthsShort[i] + '</span>';
      }
      this.picker.find('.datetimepicker-months td').html(html);
    },

    fill: function () {
      if (!this.date || !this.viewDate) {
        return;
      }
      var d = new Date(this.viewDate),
        year = d.getUTCFullYear(),
        month = d.getUTCMonth(),
        dayMonth = d.getUTCDate(),
        hours = d.getUTCHours(),
        startYear = this.startDate.getUTCFullYear(),
        startMonth = this.startDate.getUTCMonth(),
        endYear = this.endDate.getUTCFullYear(),
        endMonth = this.endDate.getUTCMonth() + 1,
        currentDate = (new UTCDate(this.date.getUTCFullYear(), this.date.getUTCMonth(), this.date.getUTCDate())).valueOf(),
        today = new Date();
      this.setTitle('.datetimepicker-days', dates[this.language].months[month] + ' ' + year)
      if (this.formatViewType === 'time') {
        var formatted = this.getFormattedDate();
        this.setTitle('.datetimepicker-hours', formatted);
        this.setTitle('.datetimepicker-minutes', formatted);
      } else {
        this.setTitle('.datetimepicker-hours', dayMonth + ' ' + dates[this.language].months[month] + ' ' + year);
        this.setTitle('.datetimepicker-minutes', dayMonth + ' ' + dates[this.language].months[month] + ' ' + year);
      }
      this.picker.find('tfoot th.today')
        .text(dates[this.language].today || dates['en'].today)
        .toggle(this.todayBtn !== false);
      this.picker.find('tfoot th.clear')
        .text(dates[this.language].clear || dates['en'].clear)
        .toggle(this.clearBtn !== false);
      this.updateNavArrows();
      this.fillMonths();
      var prevMonth = UTCDate(year, month - 1, 28, 0, 0, 0, 0),
        day = DPGlobal.getDaysInMonth(prevMonth.getUTCFullYear(), prevMonth.getUTCMonth());
      prevMonth.setUTCDate(day);
      prevMonth.setUTCDate(day - (prevMonth.getUTCDay() - this.weekStart + 7) % 7);
      var nextMonth = new Date(prevMonth);
      nextMonth.setUTCDate(nextMonth.getUTCDate() + 42);
      nextMonth = nextMonth.valueOf();
      var html = [];
      var classes;
      while (prevMonth.valueOf() < nextMonth) {
        if (prevMonth.getUTCDay() === this.weekStart) {
          html.push('<tr>');
        }
        classes = this.onRenderDay(prevMonth);
        if (prevMonth.getUTCFullYear() < year || (prevMonth.getUTCFullYear() === year && prevMonth.getUTCMonth() < month)) {
          classes.push('old');
        } else if (prevMonth.getUTCFullYear() > year || (prevMonth.getUTCFullYear() === year && prevMonth.getUTCMonth() > month)) {
          classes.push('new');
        }
        // Compare internal UTC date with local today, not UTC today
        if (this.todayHighlight &&
          prevMonth.getUTCFullYear() === today.getFullYear() &&
          prevMonth.getUTCMonth() === today.getMonth() &&
          prevMonth.getUTCDate() === today.getDate()) {
          classes.push('today');
        }
        if (prevMonth.valueOf() === currentDate) {
          classes.push('active');
        }
        if ((prevMonth.valueOf() + 86400000) <= this.startDate || prevMonth.valueOf() > this.endDate ||
          $.inArray(prevMonth.getUTCDay(), this.daysOfWeekDisabled) !== -1 ||
          $.inArray(prevMonth.toDateString(), this.datesDisabled) !== -1) {
          classes.push('disabled');
        }
        html.push('<td class="' + classes.join(' ') + '">' + prevMonth.getUTCDate() + '</td>');
		
        if (prevMonth.getUTCDay() === this.weekEnd) {
	
		  // 如果显示周
		  if( this.weekShow && html[html.length-1].indexOf('day') > -1 ){
			  var d = new Date(prevMonth.getTime() - 3600*1000*24*6);
			  var we = this.treWeeks[d.getFullYear()+'/'+(d.getMonth()+1)+'/'+d.getDate()];
			  if( !we ){
				  we = '&nbsp;'
			  }
			  
			  html.splice(html.length-7,0,'<th class="day" style="border-right: dashed 1px #ddd;pointer-events: none;">'+we+'</th>')

		  }
          html.push('</tr>');
        }
        prevMonth.setUTCDate(prevMonth.getUTCDate() + 1);
      }
      this.picker.find('.datetimepicker-days tbody').empty().append(html.join(''));

      html = [];
      var txt = '', meridian = '', meridianOld = '';
      var hoursDisabled = this.hoursDisabled || [];
      d = new Date(this.viewDate)
      for (var i = 0; i < 24; i++) {
        d.setUTCHours(i);
        classes = this.onRenderHour(d);
        if (hoursDisabled.indexOf(i) !== -1) {
          classes.push('disabled');
        }
        var actual = UTCDate(year, month, dayMonth, i);
        // We want the previous hour for the startDate
        if ((actual.valueOf() + 3600000) <= this.startDate || actual.valueOf() > this.endDate) {
          classes.push('disabled');
        } else if (hours === i) {
          classes.push('active');
        }
        if (this.showMeridian && dates[this.language].meridiem.length === 2) {
          meridian = (i < 12 ? dates[this.language].meridiem[0] : dates[this.language].meridiem[1]);
          if (meridian !== meridianOld) {
            if (meridianOld !== '') {
              html.push('</fieldset>');
            }
            html.push('<fieldset class="hour"><legend>' + meridian.toUpperCase() + '</legend>');
          }
          meridianOld = meridian;
          txt = (i % 12 ? i % 12 : 12);
          if (i < 12) {
            classes.push('hour_am');
          } else {
            classes.push('hour_pm');
          }
          html.push('<span class="' + classes.join(' ') + '">' + txt + '</span>');
          if (i === 23) {
            html.push('</fieldset>');
          }
        } else {
          txt = i + ':00';
          html.push('<span class="' + classes.join(' ') + '">' + txt + '</span>');
        }
      }
      this.picker.find('.datetimepicker-hours td').html(html.join(''));

      html = [];
      txt = '';
      meridian = '';
      meridianOld = '';
      var minutesDisabled = this.minutesDisabled || [];
      d = new Date(this.viewDate);
      for (var i = 0; i < 60; i += this.minuteStep) {
        if (minutesDisabled.indexOf(i) !== -1) continue;
        d.setUTCMinutes(i);
        d.setUTCSeconds(0);
        classes = this.onRenderMinute(d);
        if (this.showMeridian && dates[this.language].meridiem.length === 2) {
          meridian = (hours < 12 ? dates[this.language].meridiem[0] : dates[this.language].meridiem[1]);
          if (meridian !== meridianOld) {
            if (meridianOld !== '') {
              html.push('</fieldset>');
            }
            html.push('<fieldset class="minute"><legend>' + meridian.toUpperCase() + '</legend>');
          }
          meridianOld = meridian;
          txt = (hours % 12 ? hours % 12 : 12);
          html.push('<span class="' + classes.join(' ') + '">' + txt + ':' + (i < 10 ? '0' + i : i) + '</span>');
          if (i === 59) {
            html.push('</fieldset>');
          }
        } else {
          txt = i + ':00';
          html.push('<span class="' + classes.join(' ') + '">' + hours + ':' + (i < 10 ? '0' + i : i) + '</span>');
        }
      }
      this.picker.find('.datetimepicker-minutes td').html(html.join(''));

      var currentYear = this.date.getUTCFullYear();
      var months = this.setTitle('.datetimepicker-months', year)
        .end()
        .find('.month').removeClass('active');
      if (currentYear === year) {
        // getUTCMonths() returns 0 based, and we need to select the next one
        // To cater bootstrap 2 we don't need to select the next one
        months.eq(this.date.getUTCMonth()).addClass('active');
      }
      if (year < startYear || year > endYear) {
        months.addClass('disabled');
      }
      if (year === startYear) {
        months.slice(0, startMonth).addClass('disabled');
      }
      if (year === endYear) {
        months.slice(endMonth).addClass('disabled');
      }

      html = '';
      year = parseInt(year / 10, 10) * 10;
      var yearCont = this.setTitle('.datetimepicker-years', year + '-' + (year + 9))
        .end()
        .find('td');
      year -= 1;
      d = new Date(this.viewDate);
      for (var i = -1; i < 11; i++) {
        d.setUTCFullYear(year);
        classes = this.onRenderYear(d);
        if (i === -1 || i === 10) {
          classes.push(old);
        }
        html += '<span class="' + classes.join(' ') + '">' + year + '</span>';
        year += 1;
      }
      yearCont.html(html);
      this.place();
    },

    updateNavArrows: function () {
      var d = new Date(this.viewDate),
        year = d.getUTCFullYear(),
        month = d.getUTCMonth(),
        day = d.getUTCDate(),
        hour = d.getUTCHours();
      switch (this.viewMode) {
        case 0:
          if (year <= this.startDate.getUTCFullYear()
            && month <= this.startDate.getUTCMonth()
            && day <= this.startDate.getUTCDate()
            && hour <= this.startDate.getUTCHours()) {
            this.picker.find('.prev').css({visibility: 'hidden'});
          } else {
            this.picker.find('.prev').css({visibility: 'visible'});
          }
          if (year >= this.endDate.getUTCFullYear()
            && month >= this.endDate.getUTCMonth()
            && day >= this.endDate.getUTCDate()
            && hour >= this.endDate.getUTCHours()) {
            this.picker.find('.next').css({visibility: 'hidden'});
          } else {
            this.picker.find('.next').css({visibility: 'visible'});
          }
          break;
        case 1:
          if (year <= this.startDate.getUTCFullYear()
            && month <= this.startDate.getUTCMonth()
            && day <= this.startDate.getUTCDate()) {
            this.picker.find('.prev').css({visibility: 'hidden'});
          } else {
            this.picker.find('.prev').css({visibility: 'visible'});
          }
          if (year >= this.endDate.getUTCFullYear()
            && month >= this.endDate.getUTCMonth()
            && day >= this.endDate.getUTCDate()) {
            this.picker.find('.next').css({visibility: 'hidden'});
          } else {
            this.picker.find('.next').css({visibility: 'visible'});
          }
          break;
        case 2:
          if (year <= this.startDate.getUTCFullYear()
            && month <= this.startDate.getUTCMonth()) {
            this.picker.find('.prev').css({visibility: 'hidden'});
          } else {
            this.picker.find('.prev').css({visibility: 'visible'});
          }
          if (year >= this.endDate.getUTCFullYear()
            && month >= this.endDate.getUTCMonth()) {
            this.picker.find('.next').css({visibility: 'hidden'});
          } else {
            this.picker.find('.next').css({visibility: 'visible'});
          }
          break;
        case 3:
        case 4:
          if (year <= this.startDate.getUTCFullYear()) {
            this.picker.find('.prev').css({visibility: 'hidden'});
          } else {
            this.picker.find('.prev').css({visibility: 'visible'});
          }
          if (year >= this.endDate.getUTCFullYear()) {
            this.picker.find('.next').css({visibility: 'hidden'});
          } else {
            this.picker.find('.next').css({visibility: 'visible'});
          }
          break;
      }
    },

    mousewheel: function (e) {

      e.preventDefault();
      e.stopPropagation();

      if (this.wheelPause) {
        return;
      }

      this.wheelPause = true;

      var originalEvent = e.originalEvent;

      var delta = originalEvent.wheelDelta;

      var mode = delta > 0 ? 1 : (delta === 0) ? 0 : -1;

      if (this.wheelViewModeNavigationInverseDirection) {
        mode = -mode;
      }

      this.showMode(mode);

      setTimeout($.proxy(function () {

        this.wheelPause = false

      }, this), this.wheelViewModeNavigationDelay);

    },

    click: function (e) {
      e.stopPropagation();
      e.preventDefault();
      var target = $(e.target).closest('span, td, th, legend');
      if (target.is('.' + this.icontype)) {
        target = $(target).parent().closest('span, td, th, legend');
      }
      if (target.length === 1) {
        if (target.is('.disabled')) {
          this.element.trigger({
            type:      'outOfRange',
            date:      this.viewDate,
            startDate: this.startDate,
            endDate:   this.endDate
          });
          return;
        }
        switch (target[0].nodeName.toLowerCase()) {
          case 'th':
            switch (target[0].className) {
              case 'switch':
                this.showMode(1);
                break;
              case 'prev':
              case 'next':
                var dir = DPGlobal.modes[this.viewMode].navStep * (target[0].className === 'prev' ? -1 : 1);
                switch (this.viewMode) {
                  case 0:
                    this.viewDate = this.moveHour(this.viewDate, dir);
                    break;
                  case 1:
                    this.viewDate = this.moveDate(this.viewDate, dir);
                    break;
                  case 2:
                    this.viewDate = this.moveMonth(this.viewDate, dir);
                    break;
                  case 3:
                  case 4:
                    this.viewDate = this.moveYear(this.viewDate, dir);
                    break;
                }
                this.fill();
                this.element.trigger({
                  type:      target[0].className + ':' + this.convertViewModeText(this.viewMode),
                  date:      this.viewDate,
                  startDate: this.startDate,
                  endDate:   this.endDate
                });
                break;
              case 'clear':
                this.reset();
                if (this.autoclose) {
                  this.hide();
                }
                break;
              case 'today':
                var date = new Date();
                date = UTCDate(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds(), 0);

                // Respect startDate and endDate.
                if (date < this.startDate) date = this.startDate;
                else if (date > this.endDate) date = this.endDate;

                this.viewMode = this.startViewMode;
                this.showMode(0);
                this._setDate(date);
                this.fill();
                if (this.autoclose) {
                  this.hide();
                }
                break;
            }
            break;
          case 'span':
            if (!target.is('.disabled')) {
              var year = this.viewDate.getUTCFullYear(),
                month = this.viewDate.getUTCMonth(),
                day = this.viewDate.getUTCDate(),
                hours = this.viewDate.getUTCHours(),
                minutes = this.viewDate.getUTCMinutes(),
                seconds = this.viewDate.getUTCSeconds();

              if (target.is('.month')) {
                this.viewDate.setUTCDate(1);
                month = target.parent().find('span').index(target);
                day = this.viewDate.getUTCDate();
                this.viewDate.setUTCMonth(month);
                this.element.trigger({
                  type: 'changeMonth',
                  date: this.viewDate
                });
                if (this.viewSelect >= 3) {
                  this._setDate(UTCDate(year, month, day, hours, minutes, seconds, 0));
                }
              } else if (target.is('.year')) {
                this.viewDate.setUTCDate(1);
                year = parseInt(target.text(), 10) || 0;
                this.viewDate.setUTCFullYear(year);
                this.element.trigger({
                  type: 'changeYear',
                  date: this.viewDate
                });
                if (this.viewSelect >= 4) {
                  this._setDate(UTCDate(year, month, day, hours, minutes, seconds, 0));
                }
              } else if (target.is('.hour')) {
                hours = parseInt(target.text(), 10) || 0;
                if (target.hasClass('hour_am') || target.hasClass('hour_pm')) {
                  if (hours === 12 && target.hasClass('hour_am')) {
                    hours = 0;
                  } else if (hours !== 12 && target.hasClass('hour_pm')) {
                    hours += 12;
                  }
                }
                this.viewDate.setUTCHours(hours);
                this.element.trigger({
                  type: 'changeHour',
                  date: this.viewDate
                });
                if (this.viewSelect >= 1) {
                  this._setDate(UTCDate(year, month, day, hours, minutes, seconds, 0));
                }
              } else if (target.is('.minute')) {
                minutes = parseInt(target.text().substr(target.text().indexOf(':') + 1), 10) || 0;
                this.viewDate.setUTCMinutes(minutes);
                this.element.trigger({
                  type: 'changeMinute',
                  date: this.viewDate
                });
                if (this.viewSelect >= 0) {
                  this._setDate(UTCDate(year, month, day, hours, minutes, seconds, 0));
                }
              }
              if (this.viewMode !== 0) {
                var oldViewMode = this.viewMode;
                this.showMode(-1);
                this.fill();
                if (oldViewMode === this.viewMode && this.autoclose) {
                  this.hide();
                }
              } else {
                this.fill();
                if (this.autoclose) {
                  this.hide();
                }
              }
            }
            break;
          case 'td':
            if (target.is('.day') && !target.is('.disabled')) {
              var day = parseInt(target.text(), 10) || 1;
              var year = this.viewDate.getUTCFullYear(),
                month = this.viewDate.getUTCMonth(),
                hours = this.viewDate.getUTCHours(),
                minutes = this.viewDate.getUTCMinutes(),
                seconds = this.viewDate.getUTCSeconds();
              if (target.is('.old')) {
                if (month === 0) {
                  month = 11;
                  year -= 1;
                } else {
                  month -= 1;
                }
              } else if (target.is('.new')) {
                if (month === 11) {
                  month = 0;
                  year += 1;
                } else {
                  month += 1;
                }
              }
              this.viewDate.setUTCFullYear(year);
              this.viewDate.setUTCMonth(month, day);
              this.element.trigger({
                type: 'changeDay',
                date: this.viewDate
              });
              if (this.viewSelect >= 2) {
                this._setDate(UTCDate(year, month, day, hours, minutes, seconds, 0));
              }
            }
            var oldViewMode = this.viewMode;
            this.showMode(-1);
            this.fill();
            if (oldViewMode === this.viewMode && this.autoclose) {
              this.hide();
            }
            break;
        }
      }
    },

    _setDate: function (date, which) {
      if (!which || which === 'date')
        this.date = date;
      if (!which || which === 'view')
        this.viewDate = date;
      this.fill();
      this.setValue();
      var element;
      if (this.isInput) {
        element = this.element;
      } else if (this.component) {
        element = this.element.find('input');
      }
      if (element) {
        element.change();
      }
      this.element.trigger({
        type: 'changeDate',
        date: this.getDate()
      });
      if(date === null)
        this.date = this.viewDate;
    },

    moveMinute: function (date, dir) {
      if (!dir) return date;
      var new_date = new Date(date.valueOf());
      //dir = dir > 0 ? 1 : -1;
      new_date.setUTCMinutes(new_date.getUTCMinutes() + (dir * this.minuteStep));
      return new_date;
    },

    moveHour: function (date, dir) {
      if (!dir) return date;
      var new_date = new Date(date.valueOf());
      //dir = dir > 0 ? 1 : -1;
      new_date.setUTCHours(new_date.getUTCHours() + dir);
      return new_date;
    },

    moveDate: function (date, dir) {
      if (!dir) return date;
      var new_date = new Date(date.valueOf());
      //dir = dir > 0 ? 1 : -1;
      new_date.setUTCDate(new_date.getUTCDate() + dir);
      return new_date;
    },

    moveMonth: function (date, dir) {
      if (!dir) return date;
      var new_date = new Date(date.valueOf()),
        day = new_date.getUTCDate(),
        month = new_date.getUTCMonth(),
        mag = Math.abs(dir),
        new_month, test;
      dir = dir > 0 ? 1 : -1;
      if (mag === 1) {
        test = dir === -1
          // If going back one month, make sure month is not current month
          // (eg, Mar 31 -> Feb 31 === Feb 28, not Mar 02)
          ? function () {
          return new_date.getUTCMonth() === month;
        }
          // If going forward one month, make sure month is as expected
          // (eg, Jan 31 -> Feb 31 === Feb 28, not Mar 02)
          : function () {
          return new_date.getUTCMonth() !== new_month;
        };
        new_month = month + dir;
        new_date.setUTCMonth(new_month);
        // Dec -> Jan (12) or Jan -> Dec (-1) -- limit expected date to 0-11
        if (new_month < 0 || new_month > 11)
          new_month = (new_month + 12) % 12;
      } else {
        // For magnitudes >1, move one month at a time...
        for (var i = 0; i < mag; i++)
          // ...which might decrease the day (eg, Jan 31 to Feb 28, etc)...
          new_date = this.moveMonth(new_date, dir);
        // ...then reset the day, keeping it in the new month
        new_month = new_date.getUTCMonth();
        new_date.setUTCDate(day);
        test = function () {
          return new_month !== new_date.getUTCMonth();
        };
      }
      // Common date-resetting loop -- if date is beyond end of month, make it
      // end of month
      while (test()) {
        new_date.setUTCDate(--day);
        new_date.setUTCMonth(new_month);
      }
      return new_date;
    },

    moveYear: function (date, dir) {
      return this.moveMonth(date, dir * 12);
    },

    dateWithinRange: function (date) {
      return date >= this.startDate && date <= this.endDate;
    },

    keydown: function (e) {
      if (this.picker.is(':not(:visible)')) {
        if (e.keyCode === 27) // allow escape to hide and re-show picker
          this.show();
        return;
      }
      var dateChanged = false,
        dir, newDate, newViewDate;
      switch (e.keyCode) {
        case 27: // escape
          this.hide();
          e.preventDefault();
          break;
        case 37: // left
        case 39: // right
          if (!this.keyboardNavigation) break;
          dir = e.keyCode === 37 ? -1 : 1;
          var viewMode = this.viewMode;
          if (e.ctrlKey) {
            viewMode += 2;
          } else if (e.shiftKey) {
            viewMode += 1;
          }
          if (viewMode === 4) {
            newDate = this.moveYear(this.date, dir);
            newViewDate = this.moveYear(this.viewDate, dir);
          } else if (viewMode === 3) {
            newDate = this.moveMonth(this.date, dir);
            newViewDate = this.moveMonth(this.viewDate, dir);
          } else if (viewMode === 2) {
            newDate = this.moveDate(this.date, dir);
            newViewDate = this.moveDate(this.viewDate, dir);
          } else if (viewMode === 1) {
            newDate = this.moveHour(this.date, dir);
            newViewDate = this.moveHour(this.viewDate, dir);
          } else if (viewMode === 0) {
            newDate = this.moveMinute(this.date, dir);
            newViewDate = this.moveMinute(this.viewDate, dir);
          }
          if (this.dateWithinRange(newDate)) {
            this.date = newDate;
            this.viewDate = newViewDate;
            this.setValue();
            this.update();
            e.preventDefault();
            dateChanged = true;
          }
          break;
        case 38: // up
        case 40: // down
          if (!this.keyboardNavigation) break;
          dir = e.keyCode === 38 ? -1 : 1;
          viewMode = this.viewMode;
          if (e.ctrlKey) {
            viewMode += 2;
          } else if (e.shiftKey) {
            viewMode += 1;
          }
          if (viewMode === 4) {
            newDate = this.moveYear(this.date, dir);
            newViewDate = this.moveYear(this.viewDate, dir);
          } else if (viewMode === 3) {
            newDate = this.moveMonth(this.date, dir);
            newViewDate = this.moveMonth(this.viewDate, dir);
          } else if (viewMode === 2) {
            newDate = this.moveDate(this.date, dir * 7);
            newViewDate = this.moveDate(this.viewDate, dir * 7);
          } else if (viewMode === 1) {
            if (this.showMeridian) {
              newDate = this.moveHour(this.date, dir * 6);
              newViewDate = this.moveHour(this.viewDate, dir * 6);
            } else {
              newDate = this.moveHour(this.date, dir * 4);
              newViewDate = this.moveHour(this.viewDate, dir * 4);
            }
          } else if (viewMode === 0) {
            newDate = this.moveMinute(this.date, dir * 4);
            newViewDate = this.moveMinute(this.viewDate, dir * 4);
          }
          if (this.dateWithinRange(newDate)) {
            this.date = newDate;
            this.viewDate = newViewDate;
            this.setValue();
            this.update();
            e.preventDefault();
            dateChanged = true;
          }
          break;
        case 13: // enter
          if (this.viewMode !== 0) {
            var oldViewMode = this.viewMode;
            this.showMode(-1);
            this.fill();
            if (oldViewMode === this.viewMode && this.autoclose) {
              this.hide();
            }
          } else {
            this.fill();
            if (this.autoclose) {
              this.hide();
            }
          }
          e.preventDefault();
          break;
        case 9: // tab
          this.hide();
          break;
      }
      if (dateChanged) {
        var element;
        if (this.isInput) {
          element = this.element;
        } else if (this.component) {
          element = this.element.find('input');
        }
        if (element) {
          element.change();
        }
        this.element.trigger({
          type: 'changeDate',
          date: this.getDate()
        });
      }
    },

    showMode: function (dir) {
      if (dir) {
        var newViewMode = Math.max(0, Math.min(DPGlobal.modes.length - 1, this.viewMode + dir));
        if (newViewMode >= this.minView && newViewMode <= this.maxView) {
          this.element.trigger({
            type:        'changeMode',
            date:        this.viewDate,
            oldViewMode: this.viewMode,
            newViewMode: newViewMode
          });

          this.viewMode = newViewMode;
        }
      }
      /*
       vitalets: fixing bug of very special conditions:
       jquery 1.7.1 + webkit + show inline datetimepicker in bootstrap popover.
       Method show() does not set display css correctly and datetimepicker is not shown.
       Changed to .css('display', 'block') solve the problem.
       See https://github.com/vitalets/x-editable/issues/37

       In jquery 1.7.2+ everything works fine.
       */
      //this.picker.find('>div').hide().filter('.datetimepicker-'+DPGlobal.modes[this.viewMode].clsName).show();
      this.picker.find('>div').hide().filter('.datetimepicker-' + DPGlobal.modes[this.viewMode].clsName).css('display', 'block');
      this.updateNavArrows();
    },

    reset: function () {
      this._setDate(null, 'date');
    },

    convertViewModeText:  function (viewMode) {
      switch (viewMode) {
        case 4:
          return 'decade';
        case 3:
          return 'year';
        case 2:
          return 'month';
        case 1:
          return 'day';
        case 0:
          return 'hour';
      }
    }
  };

  var old = $.fn.datetimepicker;
  $.fn.datetimepicker = function (option) {
    var args = Array.apply(null, arguments);
    args.shift();
    var internal_return;
    this.each(function () {
      var $this = $(this),
        data = $this.data('datetimepicker'),
        options = typeof option === 'object' && option;
      if (!data) {
        $this.data('datetimepicker', (data = new Datetimepicker(this, $.extend({}, $.fn.datetimepicker.defaults, options))));
      }
      if (typeof option === 'string' && typeof data[option] === 'function') {
        internal_return = data[option].apply(data, args);
        if (internal_return !== undefined) {
          return false;
        }
      }
    });
    if (internal_return !== undefined)
      return internal_return;
    else
      return this;
  };

  $.fn.datetimepicker.defaults = {
  };
  $.fn.datetimepicker.Constructor = Datetimepicker;
  var dates = $.fn.datetimepicker.dates = {
    en: {
      days:        ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
      daysShort:   ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
      daysMin:     ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa', 'Su'],
      months:      ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
      monthsShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
      meridiem:    ['am', 'pm'],
      suffix:      ['st', 'nd', 'rd', 'th'],
      today:       'Today',
      clear:       'Clear'
    }
  };

  var DPGlobal = {
    modes:            [
      {
        clsName: 'minutes',
        navFnc:  'Hours',
        navStep: 1
      },
      {
        clsName: 'hours',
        navFnc:  'Date',
        navStep: 1
      },
      {
        clsName: 'days',
        navFnc:  'Month',
        navStep: 1
      },
      {
        clsName: 'months',
        navFnc:  'FullYear',
        navStep: 1
      },
      {
        clsName: 'years',
        navFnc:  'FullYear',
        navStep: 10
      }
    ],
    isLeapYear:       function (year) {
      return (((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0))
    },
    getDaysInMonth:   function (year, month) {
      return [31, (DPGlobal.isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month]
    },
    getDefaultFormat: function (type, field) {
      if (type === 'standard') {
        if (field === 'input')
          return 'yyyy-mm-dd hh:ii';
        else
          return 'yyyy-mm-dd hh:ii:ss';
      } else if (type === 'php') {
        if (field === 'input')
          return 'Y-m-d H:i';
        else
          return 'Y-m-d H:i:s';
      } else {
        throw new Error('Invalid format type.');
      }
    },
    validParts: function (type) {
      if (type === 'standard') {
        return /t|hh?|HH?|p|P|z|Z|ii?|ss?|dd?|DD?|mm?|MM?|yy(?:yy)?/g;
      } else if (type === 'php') {
        return /[dDjlNwzFmMnStyYaABgGhHis]/g;
      } else {
        throw new Error('Invalid format type.');
      }
    },
    nonpunctuation: /[^ -\/:-@\[-`{-~\t\n\rTZ]+/g,
    parseFormat: function (format, type) {
      // IE treats \0 as a string end in inputs (truncating the value),
      // so it's a bad format delimiter, anyway
      var separators = format.replace(this.validParts(type), '\0').split('\0'),
        parts = format.match(this.validParts(type));
      if (!separators || !separators.length || !parts || parts.length === 0) {
        throw new Error('Invalid date format.');
      }
      return {separators: separators, parts: parts};
    },
    parseDate: function (date, format, language, type, timezone) {
      if (date instanceof Date) {
        var dateUTC = new Date(date.valueOf() - date.getTimezoneOffset() * 60000);
        dateUTC.setMilliseconds(0);
        return dateUTC;
      }
      if (/^\d{4}\-\d{1,2}\-\d{1,2}$/.test(date)) {
        format = this.parseFormat('yyyy-mm-dd', type);
      }
      if (/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}$/.test(date)) {
        format = this.parseFormat('yyyy-mm-dd hh:ii', type);
      }
      if (/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}\:\d{1,2}[Z]{0,1}$/.test(date)) {
        format = this.parseFormat('yyyy-mm-dd hh:ii:ss', type);
      }
      if (/^[-+]\d+[dmwy]([\s,]+[-+]\d+[dmwy])*$/.test(date)) {
        var part_re = /([-+]\d+)([dmwy])/,
          parts = date.match(/([-+]\d+)([dmwy])/g),
          part, dir;
        date = new Date();
        for (var i = 0; i < parts.length; i++) {
          part = part_re.exec(parts[i]);
          dir = parseInt(part[1]);
          switch (part[2]) {
            case 'd':
              date.setUTCDate(date.getUTCDate() + dir);
              break;
            case 'm':
              date = Datetimepicker.prototype.moveMonth.call(Datetimepicker.prototype, date, dir);
              break;
            case 'w':
              date.setUTCDate(date.getUTCDate() + dir * 7);
              break;
            case 'y':
              date = Datetimepicker.prototype.moveYear.call(Datetimepicker.prototype, date, dir);
              break;
          }
        }
        return UTCDate(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds(), 0);
      }
      var parts = date && date.toString().match(this.nonpunctuation) || [],
        date = new Date(0, 0, 0, 0, 0, 0, 0),
        parsed = {},
        setters_order = ['hh', 'h', 'ii', 'i', 'ss', 's', 'yyyy', 'yy', 'M', 'MM', 'm', 'mm', 'D', 'DD', 'd', 'dd', 'H', 'HH', 'p', 'P', 'z', 'Z'],
        setters_map = {
          hh:   function (d, v) {
            return d.setUTCHours(v);
          },
          h:    function (d, v) {
            return d.setUTCHours(v);
          },
          HH:   function (d, v) {
            return d.setUTCHours(v === 12 ? 0 : v);
          },
          H:    function (d, v) {
            return d.setUTCHours(v === 12 ? 0 : v);
          },
          ii:   function (d, v) {
            return d.setUTCMinutes(v);
          },
          i:    function (d, v) {
            return d.setUTCMinutes(v);
          },
          ss:   function (d, v) {
            return d.setUTCSeconds(v);
          },
          s:    function (d, v) {
            return d.setUTCSeconds(v);
          },
          yyyy: function (d, v) {
            return d.setUTCFullYear(v);
          },
          yy:   function (d, v) {
            return d.setUTCFullYear(2000 + v);
          },
          m:    function (d, v) {
            v -= 1;
            while (v < 0) v += 12;
            v %= 12;
            d.setUTCMonth(v);
            while (d.getUTCMonth() !== v)
              if (isNaN(d.getUTCMonth()))
                return d;
              else
                d.setUTCDate(d.getUTCDate() - 1);
            return d;
          },
          d:    function (d, v) {
            return d.setUTCDate(v);
          },
          p:    function (d, v) {
            return d.setUTCHours(v === 1 ? d.getUTCHours() + 12 : d.getUTCHours());
          },
          z:    function () {
            return timezone
          }
        },
        val, filtered, part;
      setters_map['M'] = setters_map['MM'] = setters_map['mm'] = setters_map['m'];
      setters_map['dd'] = setters_map['d'];
      setters_map['P'] = setters_map['p'];
      setters_map['Z'] = setters_map['z'];
      date = UTCDate(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds());
      if (parts.length === format.parts.length) {
        for (var i = 0, cnt = format.parts.length; i < cnt; i++) {
          val = parseInt(parts[i], 10);
          part = format.parts[i];
          if (isNaN(val)) {
            switch (part) {
              case 'MM':
                filtered = $(dates[language].months).filter(function () {
                  var m = this.slice(0, parts[i].length),
                    p = parts[i].slice(0, m.length);
                  return m === p;
                });
                val = $.inArray(filtered[0], dates[language].months) + 1;
                break;
              case 'M':
                filtered = $(dates[language].monthsShort).filter(function () {
                  var m = this.slice(0, parts[i].length),
                    p = parts[i].slice(0, m.length);
                  return m.toLowerCase() === p.toLowerCase();
                });
                val = $.inArray(filtered[0], dates[language].monthsShort) + 1;
                break;
              case 'p':
              case 'P':
                val = $.inArray(parts[i].toLowerCase(), dates[language].meridiem);
                break;
              case 'z':
              case 'Z':
                timezone;
                break;

            }
          }
          parsed[part] = val;
        }
        for (var i = 0, s; i < setters_order.length; i++) {
          s = setters_order[i];
          if (s in parsed && !isNaN(parsed[s]))
            setters_map[s](date, parsed[s])
        }
      }
      return date;
    },
    formatDate:       function (date, format, language, type, timezone) {
      if (date === null) {
        return '';
      }
      var val;
      if (type === 'standard') {
        val = {
          t:    date.getTime(),
          // year
          yy:   date.getUTCFullYear().toString().substring(2),
          yyyy: date.getUTCFullYear(),
          // month
          m:    date.getUTCMonth() + 1,
          M:    dates[language].monthsShort[date.getUTCMonth()],
          MM:   dates[language].months[date.getUTCMonth()],
          // day
          d:    date.getUTCDate(),
          D:    dates[language].daysShort[date.getUTCDay()],
          DD:   dates[language].days[date.getUTCDay()],
          p:    (dates[language].meridiem.length === 2 ? dates[language].meridiem[date.getUTCHours() < 12 ? 0 : 1] : ''),
          // hour
          h:    date.getUTCHours(),
          // minute
          i:    date.getUTCMinutes(),
          // second
          s:    date.getUTCSeconds(),
          // timezone
          z:    timezone
        };

        if (dates[language].meridiem.length === 2) {
          val.H = (val.h % 12 === 0 ? 12 : val.h % 12);
        }
        else {
          val.H = val.h;
        }
        val.HH = (val.H < 10 ? '0' : '') + val.H;
        val.P = val.p.toUpperCase();
        val.Z = val.z;
        val.hh = (val.h < 10 ? '0' : '') + val.h;
        val.ii = (val.i < 10 ? '0' : '') + val.i;
        val.ss = (val.s < 10 ? '0' : '') + val.s;
        val.dd = (val.d < 10 ? '0' : '') + val.d;
        val.mm = (val.m < 10 ? '0' : '') + val.m;
      } else if (type === 'php') {
        // php format
        val = {
          // year
          y: date.getUTCFullYear().toString().substring(2),
          Y: date.getUTCFullYear(),
          // month
          F: dates[language].months[date.getUTCMonth()],
          M: dates[language].monthsShort[date.getUTCMonth()],
          n: date.getUTCMonth() + 1,
          t: DPGlobal.getDaysInMonth(date.getUTCFullYear(), date.getUTCMonth()),
          // day
          j: date.getUTCDate(),
          l: dates[language].days[date.getUTCDay()],
          D: dates[language].daysShort[date.getUTCDay()],
          w: date.getUTCDay(), // 0 -> 6
          N: (date.getUTCDay() === 0 ? 7 : date.getUTCDay()),       // 1 -> 7
          S: (date.getUTCDate() % 10 <= dates[language].suffix.length ? dates[language].suffix[date.getUTCDate() % 10 - 1] : ''),
          // hour
          a: (dates[language].meridiem.length === 2 ? dates[language].meridiem[date.getUTCHours() < 12 ? 0 : 1] : ''),
          g: (date.getUTCHours() % 12 === 0 ? 12 : date.getUTCHours() % 12),
          G: date.getUTCHours(),
          // minute
          i: date.getUTCMinutes(),
          // second
          s: date.getUTCSeconds()
        };
        val.m = (val.n < 10 ? '0' : '') + val.n;
        val.d = (val.j < 10 ? '0' : '') + val.j;
        val.A = val.a.toString().toUpperCase();
        val.h = (val.g < 10 ? '0' : '') + val.g;
        val.H = (val.G < 10 ? '0' : '') + val.G;
        val.i = (val.i < 10 ? '0' : '') + val.i;
        val.s = (val.s < 10 ? '0' : '') + val.s;
      } else {
        throw new Error('Invalid format type.');
      }
      var date = [],
        seps = $.extend([], format.separators);
      for (var i = 0, cnt = format.parts.length; i < cnt; i++) {
        if (seps.length) {
          date.push(seps.shift());
        }
        date.push(val[format.parts[i]]);
      }
      if (seps.length) {
        date.push(seps.shift());
      }
      return date.join('');
    },
    convertViewMode:  function (viewMode) {
      switch (viewMode) {
        case 4:
        case 'decade':
          viewMode = 4;
          break;
        case 3:
        case 'year':
          viewMode = 3;
          break;
        case 2:
        case 'month':
          viewMode = 2;
          break;
        case 1:
        case 'day':
          viewMode = 1;
          break;
        case 0:
        case 'hour':
          viewMode = 0;
          break;
      }

      return viewMode;
    },
    headTemplate: '<thead>' +
                '<tr>' +
                '<th class="prev"><i class="{iconType} {leftArrow}"/></th>' +
                '<th colspan="5" class="switch" name="tre-date-switch"></th>' +
                '<th class="next"><i class="{iconType} {rightArrow}"/></th>' +
                '</tr>' +
      '</thead>',
    headTemplateV3: '<thead>' +
                '<tr>' +
                '<th class="prev"><span class="{iconType} {leftArrow}"></span> </th>' +
                '<th colspan="5" class="switch" name="tre-date-switch"></th>' +
                '<th class="next"><span class="{iconType} {rightArrow}"></span> </th>' +
                '</tr>' +
      '</thead>',
    contTemplate: '<tbody><tr><td colspan="7"></td></tr></tbody>',
    footTemplate: '<tfoot>' + 
                    '<tr><th colspan="7" class="today"></th></tr>' +
                    '<tr><th colspan="7" class="clear"></th></tr>' +
                  '</tfoot>'
  };
  DPGlobal.template = '<div class="datetimepicker">' +
    '<div class="datetimepicker-minutes">' +
    '<table class=" table-condensed">' +
    DPGlobal.headTemplate +
    DPGlobal.contTemplate +
    DPGlobal.footTemplate +
    '</table>' +
    '</div>' +
    '<div class="datetimepicker-hours">' +
    '<table class=" table-condensed">' +
    DPGlobal.headTemplate +
    DPGlobal.contTemplate +
    DPGlobal.footTemplate +
    '</table>' +
    '</div>' +
    '<div class="datetimepicker-days">' +
    '<table class=" table-condensed">' +
    DPGlobal.headTemplate +
    '<tbody></tbody>' +
    DPGlobal.footTemplate +
    '</table>' +
    '</div>' +
    '<div class="datetimepicker-months">' +
    '<table class="table-condensed">' +
    DPGlobal.headTemplate +
    DPGlobal.contTemplate +
    DPGlobal.footTemplate +
    '</table>' +
    '</div>' +
    '<div class="datetimepicker-years">' +
    '<table class="table-condensed">' +
    DPGlobal.headTemplate +
    DPGlobal.contTemplate +
    DPGlobal.footTemplate +
    '</table>' +
    '</div>' +
    '</div>';
  DPGlobal.templateV3 = '<div class="datetimepicker">' +
    '<div class="datetimepicker-minutes">' +
    '<table class=" table-condensed">' +
    DPGlobal.headTemplateV3 +
    DPGlobal.contTemplate +
    DPGlobal.footTemplate +
    '</table>' +
    '</div>' +
    '<div class="datetimepicker-hours">' +
    '<table class=" table-condensed">' +
    DPGlobal.headTemplateV3 +
    DPGlobal.contTemplate +
    DPGlobal.footTemplate +
    '</table>' +
    '</div>' +
    '<div class="datetimepicker-days">' +
    '<table class=" table-condensed">' +
    DPGlobal.headTemplateV3 +
    '<tbody></tbody>' +
    DPGlobal.footTemplate +
    '</table>' +
    '</div>' +
    '<div class="datetimepicker-months">' +
    '<table class="table-condensed">' +
    DPGlobal.headTemplateV3 +
    DPGlobal.contTemplate +
    DPGlobal.footTemplate +
    '</table>' +
    '</div>' +
    '<div class="datetimepicker-years">' +
    '<table class="table-condensed">' +
    DPGlobal.headTemplateV3 +
    DPGlobal.contTemplate +
    DPGlobal.footTemplate +
    '</table>' +
    '</div>' +
    '</div>';
  $.fn.datetimepicker.DPGlobal = DPGlobal;

  /* DATETIMEPICKER NO CONFLICT
   * =================== */

  $.fn.datetimepicker.noConflict = function () {
    $.fn.datetimepicker = old;
    return this;
  };

  /* DATETIMEPICKER DATA-API
   * ================== */

  $(document).on(
    'focus.datetimepicker.data-api click.datetimepicker.data-api',
    '[data-provide="datetimepicker"]',
    function (e) {
      var $this = $(this);
      if ($this.data('datetimepicker')) return;
      e.preventDefault();
      // component click requires us to explicitly show it
      $this.datetimepicker('show');
    }
  );
  $(function () {
    $('[data-provide="datetimepicker-inline"]').datetimepicker();
  });

}));
